"use strict";var ge=Object.defineProperty;var Ci=Object.getOwnPropertyDescriptor;var Ai=Object.getOwnPropertyNames;var Ei=Object.prototype.hasOwnProperty;var Si=(e,n)=>{for(var i in n)ge(e,i,{get:n[i],enumerable:!0})},Ti=(e,n,i,t)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of Ai(n))!Ei.call(e,r)&&r!==i&&ge(e,r,{get:()=>n[r],enumerable:!(t=Ci(n,r))||t.enumerable});return e};var Ni=e=>Ti(ge({},"__esModule",{value:!0}),e);var go={};Si(go,{default:()=>pe});module.exports=Ni(go);var fe=require("obsidian");var z=class{baseUrl;token;constructor(n,i){this.baseUrl=n,this.token=i||null}setToken(n){this.token=n}async request(n,i,t,r=!1){let s={};this.token&&(s.Authorization=`Bearer ${this.token}`),t&&!r&&(s["Content-Type"]="application/json");let o=0,l=5;for(;o<l;)try{let a=await fetch(`${this.baseUrl}${i}`,{method:n,headers:s,body:r?t:t?JSON.stringify(t):void 0});if(!a.ok){let u=await a.json().catch(()=>({message:"Request failed"}));if(a.status===429){let p=a.headers.get("Retry-After"),c=p?Number.parseInt(p,10)*1e3:2**o*1e3;if(o++,o>=l)throw new O("RATE_LIMITED","Rate limited. Try again later.",429);await new Promise(f=>setTimeout(f,Math.min(c,3e4)));continue}throw a.status>=400&&a.status<500?new O(u.code||"ERROR",u.message,a.status):new O(u.code||"SERVER_ERROR",u.message||"Server error",a.status)}return a.json()}catch(a){if(a instanceof O&&a.status>=400&&a.status<500||(o++,o>=l))throw a;await new Promise(u=>setTimeout(u,2**o*1e3))}throw new Error("Max retries exceeded")}async getDeviceCode(){return this.request("POST","/auth/device-code")}async pollDeviceCode(n){return this.request("GET",`/auth/poll/${n}`)}async revokeToken(){return this.request("POST","/auth/revoke")}async getSites(){return this.request("GET","/sites")}async createSite(n){return this.request("POST","/sites",{subdomain:n})}async getSite(n){return this.request("GET",`/sites/${n}`)}async getNotes(n){return this.request("GET",`/sites/${n}/notes`)}async uploadNote(n,i,t,r,s){let o={"Content-Type":"text/markdown; charset=utf-8","X-Note-Title":encodeURIComponent(t)};s&&(o["X-Original-Path"]=encodeURIComponent(s)),this.token&&(o.Authorization=`Bearer ${this.token}`);let l=5;for(let a=0;a<l;a++){let u=await fetch(`${this.baseUrl}/sites/${n}/notes/${i}`,{method:"PUT",headers:o,body:r});if(u.ok)return u.json();if(u.status===429){let c=u.headers.get("Retry-After"),f=c?Number.parseInt(c,10)*1e3:2**a*1e3;await new Promise(h=>setTimeout(h,Math.min(f,3e4)));continue}let p=await u.json().catch(()=>({message:"Upload failed"}));throw new O(p.code||"UPLOAD_FAILED",p.message,u.status)}throw new O("RATE_LIMITED","Rate limited after multiple retries",429)}async deleteNote(n,i){return this.request("DELETE",`/sites/${n}/notes/${i}`)}async getImages(n){return this.request("GET",`/sites/${n}/images`)}async uploadImage(n,i,t){let r=new FormData,s=new Blob([i],{type:this.getMimeType(t)});return r.append("image",s,t),this.request("POST",`/sites/${n}/images`,r,!0)}async publish(n,i=!1){let t=i?"?force=true":"";return this.request("POST",`/sites/${n}/publish${t}`)}getMimeType(n){let i=n.split(".").pop()?.toLowerCase();return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml"}[i||""]||"application/octet-stream"}},O=class extends Error{code;status;constructor(n,i,t){super(i),this.code=n,this.status=t,this.name="ApiError"}};var Ge=require("obsidian"),ee=class extends Ge.Modal{code;verificationUrl;api;pollInterval=null;onSuccess;onCancel;constructor(n,i,t,r,s,o){super(n),this.code=i,this.verificationUrl=t,this.api=r,this.onSuccess=s,this.onCancel=o}onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("publish-device-code-modal"),n.createEl("h2",{text:"Connect Your Vault"}),n.createDiv({cls:"publish-instructions"}).createEl("p",{text:"Enter this code in your browser to connect:"}),n.createDiv({cls:"publish-code-display"}).createEl("span",{text:this.code,cls:"publish-code"});let r=n.createDiv({cls:"publish-button-container"}),s=r.createEl("button",{text:"Copy Code",cls:"mod-cta"});s.addEventListener("click",()=>{navigator.clipboard.writeText(this.code),s.textContent="Copied!",setTimeout(()=>{s.textContent="Copy Code"},2e3)}),r.createEl("button",{text:"Open in Browser"}).addEventListener("click",()=>{window.open(this.verificationUrl,"_blank")});let l=n.createDiv({cls:"publish-status"});l.createEl("p",{text:"Waiting for authorization..."}),n.createEl("button",{text:"Cancel",cls:"publish-cancel-button"}).addEventListener("click",()=>{this.close(),this.onCancel()}),this.startPolling(l),this.addStyles()}startPolling(n){this.pollInterval=setInterval(async()=>{try{let i=await this.api.pollDeviceCode(this.code);i.status==="completed"&&i.token?(this.stopPolling(),n.empty(),n.createEl("p",{text:"Connected successfully!",cls:"publish-status-success"}),setTimeout(()=>{this.close(),this.onSuccess({token:i.token,email:i.email||"",siteId:i.siteId,subdomain:i.subdomain})},1e3)):i.status==="expired"&&(this.stopPolling(),n.empty(),n.createEl("p",{text:"Code expired. Please try again.",cls:"publish-status-error"}))}catch{}},2e3)}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}onClose(){this.stopPolling();let{contentEl:n}=this;n.empty()}addStyles(){let n=document.createElement("style");n.textContent=`
			.publish-device-code-modal {
				padding: 20px;
				text-align: center;
			}
			.publish-device-code-modal h2 {
				margin-bottom: 16px;
			}
			.publish-instructions {
				margin-bottom: 20px;
				color: var(--text-muted);
			}
			.publish-code-display {
				background: var(--background-secondary);
				border-radius: 8px;
				padding: 20px;
				margin-bottom: 20px;
			}
			.publish-code {
				font-family: var(--font-monospace);
				font-size: 2em;
				font-weight: bold;
				letter-spacing: 0.2em;
			}
			.publish-button-container {
				display: flex;
				gap: 10px;
				justify-content: center;
				margin-bottom: 20px;
			}
			.publish-button-container button {
				padding: 8px 16px;
			}
			.publish-status {
				margin-bottom: 16px;
				color: var(--text-muted);
			}
			.publish-status-success {
				color: var(--text-success);
			}
			.publish-status-error {
				color: var(--text-error);
			}
			.publish-cancel-button {
				color: var(--text-muted);
			}
		`,this.contentEl.appendChild(n)}};function xe(e){if(!e||typeof e!="string")return"";let n=e.toLowerCase().trim();n=n.normalize("NFD").replace(/[\u0300-\u036f]/g,"");let i={\u00E6:"ae",\u0153:"oe",\u00DF:"ss",\u00F0:"d",\u00FE:"th",\u00F8:"o",\u0142:"l",\u0111:"d"};for(let[t,r]of Object.entries(i))n=n.replace(new RegExp(t,"g"),r);return n=n.replace(/[\s_]+/g,"-"),n=n.replace(/[^a-z0-9-]/g,""),n=n.replace(/-+/g,"-"),n=n.replace(/^-+|-+$/g,""),n||"untitled"}async function be(e){let i=new TextEncoder().encode(e),t=await crypto.subtle.digest("SHA-256",i);return Array.from(new Uint8Array(t)).map(o=>o.toString(16).padStart(2,"0")).join("")}var We=new Set(["www","api","app","admin","dashboard","help","support","blog","docs","status","mail","smtp","pop","imap","ftp","cdn","assets","static","img","images","js","css","auth","login","register","signup","signin","account","billing","payment","dev","staging","test","demo","portal"]),Fi=/^[a-z][a-z0-9-]{1,28}[a-z0-9]$/;function ye(e){return!(!e||typeof e!="string"||!Fi.test(e)||e.includes("--"))}function ve(e){return We.has(e.toLowerCase())}function N(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var Ke=require("obsidian"),ne=class extends Ke.Modal{api;serviceDomain;onSuccess;onCancel;constructor(n,i,t,r,s){super(n),this.api=i,this.serviceDomain=t,this.onSuccess=r,this.onCancel=s}onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("publish-subdomain-modal"),n.createEl("h2",{text:"Choose Your Site URL"}),n.createDiv({cls:"publish-instructions"}).createEl("p",{text:"Pick a unique subdomain for your published notes:"});let t=n.createDiv({cls:"publish-subdomain-input"}),r=t.createEl("input",{type:"text",placeholder:"my-notes",cls:"publish-subdomain-field"});t.createEl("span",{text:`.${this.serviceDomain}`,cls:"publish-domain-suffix"});let s=n.createDiv({cls:"publish-url-preview"});s.createEl("span",{text:"Your site will be at: "});let o=s.createEl("span",{cls:"publish-preview-url",text:`https://your-subdomain.${this.serviceDomain}`}),l=n.createDiv({cls:"publish-feedback"}),a=n.createDiv({cls:"publish-button-container"}),u=a.createEl("button",{text:"Create Site",cls:"mod-cta"});u.disabled=!0;let p=a.createEl("button",{text:"Cancel"});r.addEventListener("input",()=>{let c=r.value.toLowerCase().trim();if(o.textContent=c?`https://${c}.${this.serviceDomain}`:`https://your-subdomain.${this.serviceDomain}`,l.empty(),u.disabled=!0,!!c){if(!ye(c)){l.createEl("p",{text:"Must be 3-30 characters, start with a letter, and contain only lowercase letters, numbers, and hyphens.",cls:"publish-feedback-error"});return}if(ve(c)){l.createEl("p",{text:"This subdomain is reserved.",cls:"publish-feedback-error"});return}l.createEl("p",{text:"Looks good!",cls:"publish-feedback-success"}),u.disabled=!1}}),u.addEventListener("click",async()=>{let c=r.value.toLowerCase().trim();u.disabled=!0,u.textContent="Creating...",l.empty();try{let f=await this.api.createSite(c);this.close(),this.onSuccess(f.id,f.subdomain)}catch(f){u.disabled=!1,u.textContent="Create Site",l.empty(),l.createEl("p",{text:f instanceof Error?f.message:"Failed to create site",cls:"publish-feedback-error"})}}),p.addEventListener("click",()=>{this.close(),this.onCancel()}),this.addStyles(),r.focus()}onClose(){let{contentEl:n}=this;n.empty()}addStyles(){let n=document.createElement("style");n.textContent=`
			.publish-subdomain-modal {
				padding: 20px;
			}
			.publish-subdomain-modal h2 {
				margin-bottom: 16px;
				text-align: center;
			}
			.publish-instructions {
				margin-bottom: 20px;
				color: var(--text-muted);
				text-align: center;
			}
			.publish-subdomain-input {
				display: flex;
				align-items: center;
				background: var(--background-secondary);
				border-radius: 8px;
				padding: 8px 12px;
				margin-bottom: 12px;
			}
			.publish-subdomain-field {
				flex: 1;
				border: none;
				background: transparent;
				font-size: 1.1em;
				padding: 8px;
				outline: none;
			}
			.publish-domain-suffix {
				color: var(--text-muted);
				font-size: 1.1em;
			}
			.publish-url-preview {
				text-align: center;
				margin-bottom: 12px;
				font-size: 0.9em;
				color: var(--text-muted);
			}
			.publish-preview-url {
				color: var(--text-accent);
			}
			.publish-feedback {
				min-height: 24px;
				margin-bottom: 16px;
				text-align: center;
			}
			.publish-feedback-error {
				color: var(--text-error);
				margin: 0;
			}
			.publish-feedback-success {
				color: var(--text-success);
				margin: 0;
			}
			.publish-button-container {
				display: flex;
				gap: 10px;
				justify-content: center;
			}
			.publish-button-container button {
				padding: 8px 20px;
			}
		`,this.contentEl.appendChild(n)}};var Qe=require("obsidian"),ie=class extends Qe.Modal{statusEl=null;progressEl=null;detailsEl=null;closeButton=null;cancelled=!1;onOpen(){let{contentEl:n}=this;n.empty(),n.addClass("publish-sync-modal"),n.createEl("h2",{text:"Publishing Notes"}),this.progressEl=n.createDiv({cls:"publish-progress"}),this.progressEl.createDiv({cls:"publish-progress-bar"}),this.statusEl=n.createDiv({cls:"publish-sync-status"}),this.statusEl.createEl("p",{text:"Starting..."}),this.detailsEl=n.createDiv({cls:"publish-sync-details"});let i=n.createDiv({cls:"publish-button-container"});this.closeButton=i.createEl("button",{text:"Cancel"}),this.closeButton.addEventListener("click",()=>{this.cancelled=!0,this.close()}),this.addStyles()}setStatus(n){this.statusEl&&(this.statusEl.empty(),this.statusEl.createEl("p",{text:n}))}setProgress(n){if(this.progressEl){let i=this.progressEl.querySelector(".publish-progress-bar");i&&(i.style.width=`${n}%`)}}showSuccess(n,i){!this.statusEl||!this.detailsEl||(this.statusEl.empty(),this.statusEl.addClass("publish-status-success"),this.statusEl.createEl("p",{text:"Published successfully!"}),this.detailsEl.empty(),this.detailsEl.createEl("p",{text:`Uploaded: ${i.uploaded} | Deleted: ${i.deleted} | Unchanged: ${i.unchanged}`}),n&&this.detailsEl.createEl("a",{text:n,href:n,cls:"publish-site-link"}).addEventListener("click",r=>{r.preventDefault(),window.open(n,"_blank")}),this.closeButton&&(this.closeButton.textContent="Close"),this.setProgress(100))}showError(n){this.statusEl&&(this.statusEl.empty(),this.statusEl.addClass("publish-status-error"),this.statusEl.createEl("p",{text:"Publish failed"}),this.statusEl.createEl("p",{text:n,cls:"publish-error-message"}),this.closeButton&&(this.closeButton.textContent="Close"))}isCancelled(){return this.cancelled}onClose(){let{contentEl:n}=this;n.empty()}addStyles(){let n=document.createElement("style");n.textContent=`
			.publish-sync-modal {
				padding: 20px;
				min-width: 300px;
			}
			.publish-sync-modal h2 {
				margin-bottom: 20px;
				text-align: center;
			}
			.publish-progress {
				height: 8px;
				background: var(--background-secondary);
				border-radius: 4px;
				overflow: hidden;
				margin-bottom: 20px;
			}
			.publish-progress-bar {
				height: 100%;
				width: 0%;
				background: var(--interactive-accent);
				transition: width 0.3s ease;
			}
			.publish-sync-status {
				text-align: center;
				margin-bottom: 16px;
			}
			.publish-sync-status p {
				margin: 4px 0;
			}
			.publish-status-success {
				color: var(--text-success);
			}
			.publish-status-error {
				color: var(--text-error);
			}
			.publish-error-message {
				font-size: 0.9em;
				color: var(--text-muted);
			}
			.publish-sync-details {
				text-align: center;
				font-size: 0.9em;
				color: var(--text-muted);
				margin-bottom: 16px;
			}
			.publish-site-link {
				display: block;
				margin-top: 8px;
				color: var(--text-accent);
			}
			.publish-button-container {
				display: flex;
				justify-content: center;
			}
			.publish-button-container button {
				padding: 8px 20px;
			}
		`,this.contentEl.appendChild(n)}};var ki="https://api.pubit.site",Ii="https://auth.pubit.site",we=ki,_i=Ii,Xe=`${_i}/dashboard/`,Ze="pubit.site",G={publishTag:"publish"};var B=require("obsidian");var te=class extends B.PluginSettingTab{plugin;constructor(n,i){super(n,i),this.plugin=i}display(){let{containerEl:n}=this;n.empty();let i=!!this.plugin.settings.apiToken;if(new B.Setting(n).setName("Connection status").setDesc(i?`Connected as ${this.plugin.settings.userEmail||"Unknown"}`:"Not connected").addButton(t=>{i?t.setButtonText("Disconnect").setWarning().onClick(async()=>{await this.plugin.disconnect(),this.display()}):t.setButtonText("Connect").setCta().onClick(async()=>{await this.plugin.startDeviceCodeFlow(),setTimeout(()=>this.display(),1e3)})}),i&&this.plugin.settings.subdomain){let r=`https://${this.plugin.settings.subdomain}.${Ze}`;new B.Setting(n).setName("Your site").setDesc(r).addButton(s=>s.setButtonText("Open Site").onClick(()=>{window.open(r,"_blank")})),new B.Setting(n).setName("Dashboard").setDesc("Manage your site, edit menu order, or delete your site").addButton(s=>s.setButtonText("Open Dashboard").onClick(()=>{window.open(Xe,"_blank")}))}new B.Setting(n).setName("Publish tag").setDesc('Notes with this property set to true in frontmatter will be published (e.g., "publish: true")').addText(t=>t.setPlaceholder("publish").setValue(this.plugin.settings.publishTag||"").onChange(async r=>{this.plugin.settings.publishTag=r||G.publishTag,await this.plugin.saveSettings()}))}};function Ri(e,n="publish"){if(!e.startsWith("---"))return!1;let i=e.indexOf(`
---`,3);if(i===-1)return!1;let t=e.slice(4,i),r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${r}:\\s*["']?true["']?\\s*$`,"im").test(t)}async function Je(e,n="publish"){let i=e.vault.getMarkdownFiles(),t=[];for(let r of i){if(r.path.startsWith(".trash/")||r.path.startsWith(".obsidian/"))continue;let s=await e.vault.cachedRead(r);Ri(s,n)&&t.push(r)}return t}function en(e){return e.basename}function U(e){return e.path.replace(/\.md$/,"").split("/").map(r=>xe(r)).join("/")}function nn(e){let n=/!\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,i=[],t;for(;(t=n.exec(e))!==null;){let r=t[1].trim();/\.(png|jpg|jpeg|gif|webp|svg)$/i.test(r)&&i.push(r)}return[...new Set(i)]}function tn(e,n){let i=e.vault.getFiles(),t=n.toLowerCase(),r=n.split("/").pop()||n,s=r.toLowerCase();for(let o of i)if(o.name===n||o.name===r||o.path===n)return o;for(let o of i)if(o.name.toLowerCase()===t||o.name.toLowerCase()===s)return o;for(let o of i)if(o.path.toLowerCase().endsWith(`/${s}`))return o;if(!/\.(png|jpg|jpeg|gif|webp|svg)$/i.test(n))for(let o of["png","jpg","jpeg","gif","webp","svg"]){let a=`${r}.${o}`.toLowerCase();for(let u of i)if(u.name.toLowerCase()===a)return u}return null}function yn(e){return typeof e>"u"||e===null}function Oi(e){return typeof e=="object"&&e!==null}function Li(e){return Array.isArray(e)?e:yn(e)?[]:[e]}function Pi(e,n){var i,t,r,s;if(n)for(s=Object.keys(n),i=0,t=s.length;i<t;i+=1)r=s[i],e[r]=n[r];return e}function Bi(e,n){var i="",t;for(t=0;t<n;t+=1)i+=e;return i}function Di(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Mi=yn,Ui=Oi,$i=Li,ji=Bi,Hi=Di,Vi=Pi,w={isNothing:Mi,isObject:Ui,toArray:$i,repeat:ji,isNegativeZero:Hi,extend:Vi};function vn(e,n){var i="",t=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(i+='in "'+e.mark.name+'" '),i+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!n&&e.mark.snippet&&(i+=`

`+e.mark.snippet),t+" "+i):t}function K(e,n){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=n,this.message=vn(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}K.prototype=Object.create(Error.prototype);K.prototype.constructor=K;K.prototype.toString=function(n){return this.name+": "+vn(this,n)};var S=K;function Ce(e,n,i,t,r){var s="",o="",l=Math.floor(r/2)-1;return t-n>l&&(s=" ... ",n=t-l+s.length),i-t>l&&(o=" ...",i=t+l-o.length),{str:s+e.slice(n,i).replace(/\t/g,"\u2192")+o,pos:t-n+s.length}}function Ae(e,n){return w.repeat(" ",n-e.length)+e}function Yi(e,n){if(n=Object.create(n||null),!e.buffer)return null;n.maxLength||(n.maxLength=79),typeof n.indent!="number"&&(n.indent=1),typeof n.linesBefore!="number"&&(n.linesBefore=3),typeof n.linesAfter!="number"&&(n.linesAfter=2);for(var i=/\r?\n|\r|\0/g,t=[0],r=[],s,o=-1;s=i.exec(e.buffer);)r.push(s.index),t.push(s.index+s[0].length),e.position<=s.index&&o<0&&(o=t.length-2);o<0&&(o=t.length-1);var l="",a,u,p=Math.min(e.line+n.linesAfter,r.length).toString().length,c=n.maxLength-(n.indent+p+3);for(a=1;a<=n.linesBefore&&!(o-a<0);a++)u=Ce(e.buffer,t[o-a],r[o-a],e.position-(t[o]-t[o-a]),c),l=w.repeat(" ",n.indent)+Ae((e.line-a+1).toString(),p)+" | "+u.str+`
`+l;for(u=Ce(e.buffer,t[o],r[o],e.position,c),l+=w.repeat(" ",n.indent)+Ae((e.line+1).toString(),p)+" | "+u.str+`
`,l+=w.repeat("-",n.indent+p+3+u.pos)+`^
`,a=1;a<=n.linesAfter&&!(o+a>=r.length);a++)u=Ce(e.buffer,t[o+a],r[o+a],e.position-(t[o]-t[o+a]),c),l+=w.repeat(" ",n.indent)+Ae((e.line+a+1).toString(),p)+" | "+u.str+`
`;return l.replace(/\n$/,"")}var qi=Yi,zi=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Gi=["scalar","sequence","mapping"];function Wi(e){var n={};return e!==null&&Object.keys(e).forEach(function(i){e[i].forEach(function(t){n[String(t)]=i})}),n}function Ki(e,n){if(n=n||{},Object.keys(n).forEach(function(i){if(zi.indexOf(i)===-1)throw new S('Unknown option "'+i+'" is met in definition of "'+e+'" YAML type.')}),this.options=n,this.tag=e,this.kind=n.kind||null,this.resolve=n.resolve||function(){return!0},this.construct=n.construct||function(i){return i},this.instanceOf=n.instanceOf||null,this.predicate=n.predicate||null,this.represent=n.represent||null,this.representName=n.representName||null,this.defaultStyle=n.defaultStyle||null,this.multi=n.multi||!1,this.styleAliases=Wi(n.styleAliases||null),Gi.indexOf(this.kind)===-1)throw new S('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var C=Ki;function rn(e,n){var i=[];return e[n].forEach(function(t){var r=i.length;i.forEach(function(s,o){s.tag===t.tag&&s.kind===t.kind&&s.multi===t.multi&&(r=o)}),i[r]=t}),i}function Qi(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},n,i;function t(r){r.multi?(e.multi[r.kind].push(r),e.multi.fallback.push(r)):e[r.kind][r.tag]=e.fallback[r.tag]=r}for(n=0,i=arguments.length;n<i;n+=1)arguments[n].forEach(t);return e}function Se(e){return this.extend(e)}Se.prototype.extend=function(n){var i=[],t=[];if(n instanceof C)t.push(n);else if(Array.isArray(n))t=t.concat(n);else if(n&&(Array.isArray(n.implicit)||Array.isArray(n.explicit)))n.implicit&&(i=i.concat(n.implicit)),n.explicit&&(t=t.concat(n.explicit));else throw new S("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");i.forEach(function(s){if(!(s instanceof C))throw new S("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(s.loadKind&&s.loadKind!=="scalar")throw new S("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(s.multi)throw new S("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),t.forEach(function(s){if(!(s instanceof C))throw new S("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var r=Object.create(Se.prototype);return r.implicit=(this.implicit||[]).concat(i),r.explicit=(this.explicit||[]).concat(t),r.compiledImplicit=rn(r,"implicit"),r.compiledExplicit=rn(r,"explicit"),r.compiledTypeMap=Qi(r.compiledImplicit,r.compiledExplicit),r};var wn=Se,Cn=new C("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),An=new C("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),En=new C("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Sn=new wn({explicit:[Cn,An,En]});function Xi(e){if(e===null)return!0;var n=e.length;return n===1&&e==="~"||n===4&&(e==="null"||e==="Null"||e==="NULL")}function Zi(){return null}function Ji(e){return e===null}var Tn=new C("tag:yaml.org,2002:null",{kind:"scalar",resolve:Xi,construct:Zi,predicate:Ji,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function et(e){if(e===null)return!1;var n=e.length;return n===4&&(e==="true"||e==="True"||e==="TRUE")||n===5&&(e==="false"||e==="False"||e==="FALSE")}function nt(e){return e==="true"||e==="True"||e==="TRUE"}function it(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Nn=new C("tag:yaml.org,2002:bool",{kind:"scalar",resolve:et,construct:nt,predicate:it,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function tt(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function rt(e){return 48<=e&&e<=55}function ot(e){return 48<=e&&e<=57}function st(e){if(e===null)return!1;var n=e.length,i=0,t=!1,r;if(!n)return!1;if(r=e[i],(r==="-"||r==="+")&&(r=e[++i]),r==="0"){if(i+1===n)return!0;if(r=e[++i],r==="b"){for(i++;i<n;i++)if(r=e[i],r!=="_"){if(r!=="0"&&r!=="1")return!1;t=!0}return t&&r!=="_"}if(r==="x"){for(i++;i<n;i++)if(r=e[i],r!=="_"){if(!tt(e.charCodeAt(i)))return!1;t=!0}return t&&r!=="_"}if(r==="o"){for(i++;i<n;i++)if(r=e[i],r!=="_"){if(!rt(e.charCodeAt(i)))return!1;t=!0}return t&&r!=="_"}}if(r==="_")return!1;for(;i<n;i++)if(r=e[i],r!=="_"){if(!ot(e.charCodeAt(i)))return!1;t=!0}return!(!t||r==="_")}function lt(e){var n=e,i=1,t;if(n.indexOf("_")!==-1&&(n=n.replace(/_/g,"")),t=n[0],(t==="-"||t==="+")&&(t==="-"&&(i=-1),n=n.slice(1),t=n[0]),n==="0")return 0;if(t==="0"){if(n[1]==="b")return i*parseInt(n.slice(2),2);if(n[1]==="x")return i*parseInt(n.slice(2),16);if(n[1]==="o")return i*parseInt(n.slice(2),8)}return i*parseInt(n,10)}function at(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!w.isNegativeZero(e)}var Fn=new C("tag:yaml.org,2002:int",{kind:"scalar",resolve:st,construct:lt,predicate:at,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ut=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function ct(e){return!(e===null||!ut.test(e)||e[e.length-1]==="_")}function pt(e){var n,i;return n=e.replace(/_/g,"").toLowerCase(),i=n[0]==="-"?-1:1,"+-".indexOf(n[0])>=0&&(n=n.slice(1)),n===".inf"?i===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:n===".nan"?NaN:i*parseFloat(n,10)}var ft=/^[-+]?[0-9]+e/;function dt(e,n){var i;if(isNaN(e))switch(n){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(n){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(n){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(w.isNegativeZero(e))return"-0.0";return i=e.toString(10),ft.test(i)?i.replace("e",".e"):i}function ht(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||w.isNegativeZero(e))}var kn=new C("tag:yaml.org,2002:float",{kind:"scalar",resolve:ct,construct:pt,predicate:ht,represent:dt,defaultStyle:"lowercase"}),In=Sn.extend({implicit:[Tn,Nn,Fn,kn]}),_n=In,Rn=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),On=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function mt(e){return e===null?!1:Rn.exec(e)!==null||On.exec(e)!==null}function gt(e){var n,i,t,r,s,o,l,a=0,u=null,p,c,f;if(n=Rn.exec(e),n===null&&(n=On.exec(e)),n===null)throw new Error("Date resolve error");if(i=+n[1],t=+n[2]-1,r=+n[3],!n[4])return new Date(Date.UTC(i,t,r));if(s=+n[4],o=+n[5],l=+n[6],n[7]){for(a=n[7].slice(0,3);a.length<3;)a+="0";a=+a}return n[9]&&(p=+n[10],c=+(n[11]||0),u=(p*60+c)*6e4,n[9]==="-"&&(u=-u)),f=new Date(Date.UTC(i,t,r,s,o,l,a)),u&&f.setTime(f.getTime()-u),f}function xt(e){return e.toISOString()}var Ln=new C("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:mt,construct:gt,instanceOf:Date,represent:xt});function bt(e){return e==="<<"||e===null}var Pn=new C("tag:yaml.org,2002:merge",{kind:"scalar",resolve:bt}),Ie=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function yt(e){if(e===null)return!1;var n,i,t=0,r=e.length,s=Ie;for(i=0;i<r;i++)if(n=s.indexOf(e.charAt(i)),!(n>64)){if(n<0)return!1;t+=6}return t%8===0}function vt(e){var n,i,t=e.replace(/[\r\n=]/g,""),r=t.length,s=Ie,o=0,l=[];for(n=0;n<r;n++)n%4===0&&n&&(l.push(o>>16&255),l.push(o>>8&255),l.push(o&255)),o=o<<6|s.indexOf(t.charAt(n));return i=r%4*6,i===0?(l.push(o>>16&255),l.push(o>>8&255),l.push(o&255)):i===18?(l.push(o>>10&255),l.push(o>>2&255)):i===12&&l.push(o>>4&255),new Uint8Array(l)}function wt(e){var n="",i=0,t,r,s=e.length,o=Ie;for(t=0;t<s;t++)t%3===0&&t&&(n+=o[i>>18&63],n+=o[i>>12&63],n+=o[i>>6&63],n+=o[i&63]),i=(i<<8)+e[t];return r=s%3,r===0?(n+=o[i>>18&63],n+=o[i>>12&63],n+=o[i>>6&63],n+=o[i&63]):r===2?(n+=o[i>>10&63],n+=o[i>>4&63],n+=o[i<<2&63],n+=o[64]):r===1&&(n+=o[i>>2&63],n+=o[i<<4&63],n+=o[64],n+=o[64]),n}function Ct(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Bn=new C("tag:yaml.org,2002:binary",{kind:"scalar",resolve:yt,construct:vt,predicate:Ct,represent:wt}),At=Object.prototype.hasOwnProperty,Et=Object.prototype.toString;function St(e){if(e===null)return!0;var n=[],i,t,r,s,o,l=e;for(i=0,t=l.length;i<t;i+=1){if(r=l[i],o=!1,Et.call(r)!=="[object Object]")return!1;for(s in r)if(At.call(r,s))if(!o)o=!0;else return!1;if(!o)return!1;if(n.indexOf(s)===-1)n.push(s);else return!1}return!0}function Tt(e){return e!==null?e:[]}var Dn=new C("tag:yaml.org,2002:omap",{kind:"sequence",resolve:St,construct:Tt}),Nt=Object.prototype.toString;function Ft(e){if(e===null)return!0;var n,i,t,r,s,o=e;for(s=new Array(o.length),n=0,i=o.length;n<i;n+=1){if(t=o[n],Nt.call(t)!=="[object Object]"||(r=Object.keys(t),r.length!==1))return!1;s[n]=[r[0],t[r[0]]]}return!0}function kt(e){if(e===null)return[];var n,i,t,r,s,o=e;for(s=new Array(o.length),n=0,i=o.length;n<i;n+=1)t=o[n],r=Object.keys(t),s[n]=[r[0],t[r[0]]];return s}var Mn=new C("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:Ft,construct:kt}),It=Object.prototype.hasOwnProperty;function _t(e){if(e===null)return!0;var n,i=e;for(n in i)if(It.call(i,n)&&i[n]!==null)return!1;return!0}function Rt(e){return e!==null?e:{}}var Un=new C("tag:yaml.org,2002:set",{kind:"mapping",resolve:_t,construct:Rt}),_e=_n.extend({implicit:[Ln,Pn],explicit:[Bn,Dn,Mn,Un]}),P=Object.prototype.hasOwnProperty,re=1,$n=2,jn=3,oe=4,Ee=1,Ot=2,on=3,Lt=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,Pt=/[\x85\u2028\u2029]/,Bt=/[,\[\]\{\}]/,Hn=/^(?:!|!!|![a-z\-]+!)$/i,Vn=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function sn(e){return Object.prototype.toString.call(e)}function k(e){return e===10||e===13}function M(e){return e===9||e===32}function F(e){return e===9||e===32||e===10||e===13}function j(e){return e===44||e===91||e===93||e===123||e===125}function Dt(e){var n;return 48<=e&&e<=57?e-48:(n=e|32,97<=n&&n<=102?n-97+10:-1)}function Mt(e){return e===120?2:e===117?4:e===85?8:0}function Ut(e){return 48<=e&&e<=57?e-48:-1}function ln(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function $t(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function Yn(e,n,i){n==="__proto__"?Object.defineProperty(e,n,{configurable:!0,enumerable:!0,writable:!0,value:i}):e[n]=i}var qn=new Array(256),zn=new Array(256);for(D=0;D<256;D++)qn[D]=ln(D)?1:0,zn[D]=ln(D);var D;function jt(e,n){this.input=e,this.filename=n.filename||null,this.schema=n.schema||_e,this.onWarning=n.onWarning||null,this.legacy=n.legacy||!1,this.json=n.json||!1,this.listener=n.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Gn(e,n){var i={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return i.snippet=qi(i),new S(n,i)}function d(e,n){throw Gn(e,n)}function se(e,n){e.onWarning&&e.onWarning.call(null,Gn(e,n))}var an={YAML:function(n,i,t){var r,s,o;n.version!==null&&d(n,"duplication of %YAML directive"),t.length!==1&&d(n,"YAML directive accepts exactly one argument"),r=/^([0-9]+)\.([0-9]+)$/.exec(t[0]),r===null&&d(n,"ill-formed argument of the YAML directive"),s=parseInt(r[1],10),o=parseInt(r[2],10),s!==1&&d(n,"unacceptable YAML version of the document"),n.version=t[0],n.checkLineBreaks=o<2,o!==1&&o!==2&&se(n,"unsupported YAML version of the document")},TAG:function(n,i,t){var r,s;t.length!==2&&d(n,"TAG directive accepts exactly two arguments"),r=t[0],s=t[1],Hn.test(r)||d(n,"ill-formed tag handle (first argument) of the TAG directive"),P.call(n.tagMap,r)&&d(n,'there is a previously declared suffix for "'+r+'" tag handle'),Vn.test(s)||d(n,"ill-formed tag prefix (second argument) of the TAG directive");try{s=decodeURIComponent(s)}catch{d(n,"tag prefix is malformed: "+s)}n.tagMap[r]=s}};function L(e,n,i,t){var r,s,o,l;if(n<i){if(l=e.input.slice(n,i),t)for(r=0,s=l.length;r<s;r+=1)o=l.charCodeAt(r),o===9||32<=o&&o<=1114111||d(e,"expected valid JSON character");else Lt.test(l)&&d(e,"the stream contains non-printable characters");e.result+=l}}function un(e,n,i,t){var r,s,o,l;for(w.isObject(i)||d(e,"cannot merge mappings; the provided source object is unacceptable"),r=Object.keys(i),o=0,l=r.length;o<l;o+=1)s=r[o],P.call(n,s)||(Yn(n,s,i[s]),t[s]=!0)}function H(e,n,i,t,r,s,o,l,a){var u,p;if(Array.isArray(r))for(r=Array.prototype.slice.call(r),u=0,p=r.length;u<p;u+=1)Array.isArray(r[u])&&d(e,"nested arrays are not supported inside keys"),typeof r=="object"&&sn(r[u])==="[object Object]"&&(r[u]="[object Object]");if(typeof r=="object"&&sn(r)==="[object Object]"&&(r="[object Object]"),r=String(r),n===null&&(n={}),t==="tag:yaml.org,2002:merge")if(Array.isArray(s))for(u=0,p=s.length;u<p;u+=1)un(e,n,s[u],i);else un(e,n,s,i);else!e.json&&!P.call(i,r)&&P.call(n,r)&&(e.line=o||e.line,e.lineStart=l||e.lineStart,e.position=a||e.position,d(e,"duplicated mapping key")),Yn(n,r,s),delete i[r];return n}function Re(e){var n;n=e.input.charCodeAt(e.position),n===10?e.position++:n===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):d(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function v(e,n,i){for(var t=0,r=e.input.charCodeAt(e.position);r!==0;){for(;M(r);)r===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),r=e.input.charCodeAt(++e.position);if(n&&r===35)do r=e.input.charCodeAt(++e.position);while(r!==10&&r!==13&&r!==0);if(k(r))for(Re(e),r=e.input.charCodeAt(e.position),t++,e.lineIndent=0;r===32;)e.lineIndent++,r=e.input.charCodeAt(++e.position);else break}return i!==-1&&t!==0&&e.lineIndent<i&&se(e,"deficient indentation"),t}function ue(e){var n=e.position,i;return i=e.input.charCodeAt(n),!!((i===45||i===46)&&i===e.input.charCodeAt(n+1)&&i===e.input.charCodeAt(n+2)&&(n+=3,i=e.input.charCodeAt(n),i===0||F(i)))}function Oe(e,n){n===1?e.result+=" ":n>1&&(e.result+=w.repeat(`
`,n-1))}function Ht(e,n,i){var t,r,s,o,l,a,u,p,c=e.kind,f=e.result,h;if(h=e.input.charCodeAt(e.position),F(h)||j(h)||h===35||h===38||h===42||h===33||h===124||h===62||h===39||h===34||h===37||h===64||h===96||(h===63||h===45)&&(r=e.input.charCodeAt(e.position+1),F(r)||i&&j(r)))return!1;for(e.kind="scalar",e.result="",s=o=e.position,l=!1;h!==0;){if(h===58){if(r=e.input.charCodeAt(e.position+1),F(r)||i&&j(r))break}else if(h===35){if(t=e.input.charCodeAt(e.position-1),F(t))break}else{if(e.position===e.lineStart&&ue(e)||i&&j(h))break;if(k(h))if(a=e.line,u=e.lineStart,p=e.lineIndent,v(e,!1,-1),e.lineIndent>=n){l=!0,h=e.input.charCodeAt(e.position);continue}else{e.position=o,e.line=a,e.lineStart=u,e.lineIndent=p;break}}l&&(L(e,s,o,!1),Oe(e,e.line-a),s=o=e.position,l=!1),M(h)||(o=e.position+1),h=e.input.charCodeAt(++e.position)}return L(e,s,o,!1),e.result?!0:(e.kind=c,e.result=f,!1)}function Vt(e,n){var i,t,r;if(i=e.input.charCodeAt(e.position),i!==39)return!1;for(e.kind="scalar",e.result="",e.position++,t=r=e.position;(i=e.input.charCodeAt(e.position))!==0;)if(i===39)if(L(e,t,e.position,!0),i=e.input.charCodeAt(++e.position),i===39)t=e.position,e.position++,r=e.position;else return!0;else k(i)?(L(e,t,r,!0),Oe(e,v(e,!1,n)),t=r=e.position):e.position===e.lineStart&&ue(e)?d(e,"unexpected end of the document within a single quoted scalar"):(e.position++,r=e.position);d(e,"unexpected end of the stream within a single quoted scalar")}function Yt(e,n){var i,t,r,s,o,l;if(l=e.input.charCodeAt(e.position),l!==34)return!1;for(e.kind="scalar",e.result="",e.position++,i=t=e.position;(l=e.input.charCodeAt(e.position))!==0;){if(l===34)return L(e,i,e.position,!0),e.position++,!0;if(l===92){if(L(e,i,e.position,!0),l=e.input.charCodeAt(++e.position),k(l))v(e,!1,n);else if(l<256&&qn[l])e.result+=zn[l],e.position++;else if((o=Mt(l))>0){for(r=o,s=0;r>0;r--)l=e.input.charCodeAt(++e.position),(o=Dt(l))>=0?s=(s<<4)+o:d(e,"expected hexadecimal character");e.result+=$t(s),e.position++}else d(e,"unknown escape sequence");i=t=e.position}else k(l)?(L(e,i,t,!0),Oe(e,v(e,!1,n)),i=t=e.position):e.position===e.lineStart&&ue(e)?d(e,"unexpected end of the document within a double quoted scalar"):(e.position++,t=e.position)}d(e,"unexpected end of the stream within a double quoted scalar")}function qt(e,n){var i=!0,t,r,s,o=e.tag,l,a=e.anchor,u,p,c,f,h,m=Object.create(null),x,b,T,g;if(g=e.input.charCodeAt(e.position),g===91)p=93,h=!1,l=[];else if(g===123)p=125,h=!0,l={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=l),g=e.input.charCodeAt(++e.position);g!==0;){if(v(e,!0,n),g=e.input.charCodeAt(e.position),g===p)return e.position++,e.tag=o,e.anchor=a,e.kind=h?"mapping":"sequence",e.result=l,!0;i?g===44&&d(e,"expected the node content, but found ','"):d(e,"missed comma between flow collection entries"),b=x=T=null,c=f=!1,g===63&&(u=e.input.charCodeAt(e.position+1),F(u)&&(c=f=!0,e.position++,v(e,!0,n))),t=e.line,r=e.lineStart,s=e.position,V(e,n,re,!1,!0),b=e.tag,x=e.result,v(e,!0,n),g=e.input.charCodeAt(e.position),(f||e.line===t)&&g===58&&(c=!0,g=e.input.charCodeAt(++e.position),v(e,!0,n),V(e,n,re,!1,!0),T=e.result),h?H(e,l,m,b,x,T,t,r,s):c?l.push(H(e,null,m,b,x,T,t,r,s)):l.push(x),v(e,!0,n),g=e.input.charCodeAt(e.position),g===44?(i=!0,g=e.input.charCodeAt(++e.position)):i=!1}d(e,"unexpected end of the stream within a flow collection")}function zt(e,n){var i,t,r=Ee,s=!1,o=!1,l=n,a=0,u=!1,p,c;if(c=e.input.charCodeAt(e.position),c===124)t=!1;else if(c===62)t=!0;else return!1;for(e.kind="scalar",e.result="";c!==0;)if(c=e.input.charCodeAt(++e.position),c===43||c===45)Ee===r?r=c===43?on:Ot:d(e,"repeat of a chomping mode identifier");else if((p=Ut(c))>=0)p===0?d(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):o?d(e,"repeat of an indentation width identifier"):(l=n+p-1,o=!0);else break;if(M(c)){do c=e.input.charCodeAt(++e.position);while(M(c));if(c===35)do c=e.input.charCodeAt(++e.position);while(!k(c)&&c!==0)}for(;c!==0;){for(Re(e),e.lineIndent=0,c=e.input.charCodeAt(e.position);(!o||e.lineIndent<l)&&c===32;)e.lineIndent++,c=e.input.charCodeAt(++e.position);if(!o&&e.lineIndent>l&&(l=e.lineIndent),k(c)){a++;continue}if(e.lineIndent<l){r===on?e.result+=w.repeat(`
`,s?1+a:a):r===Ee&&s&&(e.result+=`
`);break}for(t?M(c)?(u=!0,e.result+=w.repeat(`
`,s?1+a:a)):u?(u=!1,e.result+=w.repeat(`
`,a+1)):a===0?s&&(e.result+=" "):e.result+=w.repeat(`
`,a):e.result+=w.repeat(`
`,s?1+a:a),s=!0,o=!0,a=0,i=e.position;!k(c)&&c!==0;)c=e.input.charCodeAt(++e.position);L(e,i,e.position,!1)}return!0}function cn(e,n){var i,t=e.tag,r=e.anchor,s=[],o,l=!1,a;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),a=e.input.charCodeAt(e.position);a!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,d(e,"tab characters must not be used in indentation")),!(a!==45||(o=e.input.charCodeAt(e.position+1),!F(o))));){if(l=!0,e.position++,v(e,!0,-1)&&e.lineIndent<=n){s.push(null),a=e.input.charCodeAt(e.position);continue}if(i=e.line,V(e,n,jn,!1,!0),s.push(e.result),v(e,!0,-1),a=e.input.charCodeAt(e.position),(e.line===i||e.lineIndent>n)&&a!==0)d(e,"bad indentation of a sequence entry");else if(e.lineIndent<n)break}return l?(e.tag=t,e.anchor=r,e.kind="sequence",e.result=s,!0):!1}function Gt(e,n,i){var t,r,s,o,l,a,u=e.tag,p=e.anchor,c={},f=Object.create(null),h=null,m=null,x=null,b=!1,T=!1,g;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=c),g=e.input.charCodeAt(e.position);g!==0;){if(!b&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,d(e,"tab characters must not be used in indentation")),t=e.input.charCodeAt(e.position+1),s=e.line,(g===63||g===58)&&F(t))g===63?(b&&(H(e,c,f,h,m,null,o,l,a),h=m=x=null),T=!0,b=!0,r=!0):b?(b=!1,r=!0):d(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,g=t;else{if(o=e.line,l=e.lineStart,a=e.position,!V(e,i,$n,!1,!0))break;if(e.line===s){for(g=e.input.charCodeAt(e.position);M(g);)g=e.input.charCodeAt(++e.position);if(g===58)g=e.input.charCodeAt(++e.position),F(g)||d(e,"a whitespace character is expected after the key-value separator within a block mapping"),b&&(H(e,c,f,h,m,null,o,l,a),h=m=x=null),T=!0,b=!1,r=!1,h=e.tag,m=e.result;else if(T)d(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=u,e.anchor=p,!0}else if(T)d(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=u,e.anchor=p,!0}if((e.line===s||e.lineIndent>n)&&(b&&(o=e.line,l=e.lineStart,a=e.position),V(e,n,oe,!0,r)&&(b?m=e.result:x=e.result),b||(H(e,c,f,h,m,x,o,l,a),h=m=x=null),v(e,!0,-1),g=e.input.charCodeAt(e.position)),(e.line===s||e.lineIndent>n)&&g!==0)d(e,"bad indentation of a mapping entry");else if(e.lineIndent<n)break}return b&&H(e,c,f,h,m,null,o,l,a),T&&(e.tag=u,e.anchor=p,e.kind="mapping",e.result=c),T}function Wt(e){var n,i=!1,t=!1,r,s,o;if(o=e.input.charCodeAt(e.position),o!==33)return!1;if(e.tag!==null&&d(e,"duplication of a tag property"),o=e.input.charCodeAt(++e.position),o===60?(i=!0,o=e.input.charCodeAt(++e.position)):o===33?(t=!0,r="!!",o=e.input.charCodeAt(++e.position)):r="!",n=e.position,i){do o=e.input.charCodeAt(++e.position);while(o!==0&&o!==62);e.position<e.length?(s=e.input.slice(n,e.position),o=e.input.charCodeAt(++e.position)):d(e,"unexpected end of the stream within a verbatim tag")}else{for(;o!==0&&!F(o);)o===33&&(t?d(e,"tag suffix cannot contain exclamation marks"):(r=e.input.slice(n-1,e.position+1),Hn.test(r)||d(e,"named tag handle cannot contain such characters"),t=!0,n=e.position+1)),o=e.input.charCodeAt(++e.position);s=e.input.slice(n,e.position),Bt.test(s)&&d(e,"tag suffix cannot contain flow indicator characters")}s&&!Vn.test(s)&&d(e,"tag name cannot contain such characters: "+s);try{s=decodeURIComponent(s)}catch{d(e,"tag name is malformed: "+s)}return i?e.tag=s:P.call(e.tagMap,r)?e.tag=e.tagMap[r]+s:r==="!"?e.tag="!"+s:r==="!!"?e.tag="tag:yaml.org,2002:"+s:d(e,'undeclared tag handle "'+r+'"'),!0}function Kt(e){var n,i;if(i=e.input.charCodeAt(e.position),i!==38)return!1;for(e.anchor!==null&&d(e,"duplication of an anchor property"),i=e.input.charCodeAt(++e.position),n=e.position;i!==0&&!F(i)&&!j(i);)i=e.input.charCodeAt(++e.position);return e.position===n&&d(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(n,e.position),!0}function Qt(e){var n,i,t;if(t=e.input.charCodeAt(e.position),t!==42)return!1;for(t=e.input.charCodeAt(++e.position),n=e.position;t!==0&&!F(t)&&!j(t);)t=e.input.charCodeAt(++e.position);return e.position===n&&d(e,"name of an alias node must contain at least one character"),i=e.input.slice(n,e.position),P.call(e.anchorMap,i)||d(e,'unidentified alias "'+i+'"'),e.result=e.anchorMap[i],v(e,!0,-1),!0}function V(e,n,i,t,r){var s,o,l,a=1,u=!1,p=!1,c,f,h,m,x,b;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,s=o=l=oe===i||jn===i,t&&v(e,!0,-1)&&(u=!0,e.lineIndent>n?a=1:e.lineIndent===n?a=0:e.lineIndent<n&&(a=-1)),a===1)for(;Wt(e)||Kt(e);)v(e,!0,-1)?(u=!0,l=s,e.lineIndent>n?a=1:e.lineIndent===n?a=0:e.lineIndent<n&&(a=-1)):l=!1;if(l&&(l=u||r),(a===1||oe===i)&&(re===i||$n===i?x=n:x=n+1,b=e.position-e.lineStart,a===1?l&&(cn(e,b)||Gt(e,b,x))||qt(e,x)?p=!0:(o&&zt(e,x)||Vt(e,x)||Yt(e,x)?p=!0:Qt(e)?(p=!0,(e.tag!==null||e.anchor!==null)&&d(e,"alias node should not have any properties")):Ht(e,x,re===i)&&(p=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):a===0&&(p=l&&cn(e,b))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&d(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),c=0,f=e.implicitTypes.length;c<f;c+=1)if(m=e.implicitTypes[c],m.resolve(e.result)){e.result=m.construct(e.result),e.tag=m.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(P.call(e.typeMap[e.kind||"fallback"],e.tag))m=e.typeMap[e.kind||"fallback"][e.tag];else for(m=null,h=e.typeMap.multi[e.kind||"fallback"],c=0,f=h.length;c<f;c+=1)if(e.tag.slice(0,h[c].tag.length)===h[c].tag){m=h[c];break}m||d(e,"unknown tag !<"+e.tag+">"),e.result!==null&&m.kind!==e.kind&&d(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+m.kind+'", not "'+e.kind+'"'),m.resolve(e.result,e.tag)?(e.result=m.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):d(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||p}function Xt(e){var n=e.position,i,t,r,s=!1,o;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(o=e.input.charCodeAt(e.position))!==0&&(v(e,!0,-1),o=e.input.charCodeAt(e.position),!(e.lineIndent>0||o!==37));){for(s=!0,o=e.input.charCodeAt(++e.position),i=e.position;o!==0&&!F(o);)o=e.input.charCodeAt(++e.position);for(t=e.input.slice(i,e.position),r=[],t.length<1&&d(e,"directive name must not be less than one character in length");o!==0;){for(;M(o);)o=e.input.charCodeAt(++e.position);if(o===35){do o=e.input.charCodeAt(++e.position);while(o!==0&&!k(o));break}if(k(o))break;for(i=e.position;o!==0&&!F(o);)o=e.input.charCodeAt(++e.position);r.push(e.input.slice(i,e.position))}o!==0&&Re(e),P.call(an,t)?an[t](e,t,r):se(e,'unknown document directive "'+t+'"')}if(v(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,v(e,!0,-1)):s&&d(e,"directives end mark is expected"),V(e,e.lineIndent-1,oe,!1,!0),v(e,!0,-1),e.checkLineBreaks&&Pt.test(e.input.slice(n,e.position))&&se(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&ue(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,v(e,!0,-1));return}if(e.position<e.length-1)d(e,"end of the stream or a document separator is expected");else return}function Wn(e,n){e=String(e),n=n||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var i=new jt(e,n),t=e.indexOf("\0");for(t!==-1&&(i.position=t,d(i,"null byte is not allowed in input")),i.input+="\0";i.input.charCodeAt(i.position)===32;)i.lineIndent+=1,i.position+=1;for(;i.position<i.length-1;)Xt(i);return i.documents}function Zt(e,n,i){n!==null&&typeof n=="object"&&typeof i>"u"&&(i=n,n=null);var t=Wn(e,i);if(typeof n!="function")return t;for(var r=0,s=t.length;r<s;r+=1)n(t[r])}function Jt(e,n){var i=Wn(e,n);if(i.length!==0){if(i.length===1)return i[0];throw new S("expected a single document in the stream, but found more")}}var er=Zt,nr=Jt,Kn={loadAll:er,load:nr},Qn=Object.prototype.toString,Xn=Object.prototype.hasOwnProperty,Le=65279,ir=9,Q=10,tr=13,rr=32,or=33,sr=34,Te=35,lr=37,ar=38,ur=39,cr=42,Zn=44,pr=45,le=58,fr=61,dr=62,hr=63,mr=64,Jn=91,ei=93,gr=96,ni=123,xr=124,ii=125,A={};A[0]="\\0";A[7]="\\a";A[8]="\\b";A[9]="\\t";A[10]="\\n";A[11]="\\v";A[12]="\\f";A[13]="\\r";A[27]="\\e";A[34]='\\"';A[92]="\\\\";A[133]="\\N";A[160]="\\_";A[8232]="\\L";A[8233]="\\P";var br=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],yr=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function vr(e,n){var i,t,r,s,o,l,a;if(n===null)return{};for(i={},t=Object.keys(n),r=0,s=t.length;r<s;r+=1)o=t[r],l=String(n[o]),o.slice(0,2)==="!!"&&(o="tag:yaml.org,2002:"+o.slice(2)),a=e.compiledTypeMap.fallback[o],a&&Xn.call(a.styleAliases,l)&&(l=a.styleAliases[l]),i[o]=l;return i}function wr(e){var n,i,t;if(n=e.toString(16).toUpperCase(),e<=255)i="x",t=2;else if(e<=65535)i="u",t=4;else if(e<=4294967295)i="U",t=8;else throw new S("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+i+w.repeat("0",t-n.length)+n}var Cr=1,X=2;function Ar(e){this.schema=e.schema||_e,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=w.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=vr(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?X:Cr,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function pn(e,n){for(var i=w.repeat(" ",n),t=0,r=-1,s="",o,l=e.length;t<l;)r=e.indexOf(`
`,t),r===-1?(o=e.slice(t),t=l):(o=e.slice(t,r+1),t=r+1),o.length&&o!==`
`&&(s+=i),s+=o;return s}function Ne(e,n){return`
`+w.repeat(" ",e.indent*n)}function Er(e,n){var i,t,r;for(i=0,t=e.implicitTypes.length;i<t;i+=1)if(r=e.implicitTypes[i],r.resolve(n))return!0;return!1}function ae(e){return e===rr||e===ir}function Z(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Le||65536<=e&&e<=1114111}function fn(e){return Z(e)&&e!==Le&&e!==tr&&e!==Q}function dn(e,n,i){var t=fn(e),r=t&&!ae(e);return(i?t:t&&e!==Zn&&e!==Jn&&e!==ei&&e!==ni&&e!==ii)&&e!==Te&&!(n===le&&!r)||fn(n)&&!ae(n)&&e===Te||n===le&&r}function Sr(e){return Z(e)&&e!==Le&&!ae(e)&&e!==pr&&e!==hr&&e!==le&&e!==Zn&&e!==Jn&&e!==ei&&e!==ni&&e!==ii&&e!==Te&&e!==ar&&e!==cr&&e!==or&&e!==xr&&e!==fr&&e!==dr&&e!==ur&&e!==sr&&e!==lr&&e!==mr&&e!==gr}function Tr(e){return!ae(e)&&e!==le}function W(e,n){var i=e.charCodeAt(n),t;return i>=55296&&i<=56319&&n+1<e.length&&(t=e.charCodeAt(n+1),t>=56320&&t<=57343)?(i-55296)*1024+t-56320+65536:i}function ti(e){var n=/^\n* /;return n.test(e)}var ri=1,Fe=2,oi=3,si=4,$=5;function Nr(e,n,i,t,r,s,o,l){var a,u=0,p=null,c=!1,f=!1,h=t!==-1,m=-1,x=Sr(W(e,0))&&Tr(W(e,e.length-1));if(n||o)for(a=0;a<e.length;u>=65536?a+=2:a++){if(u=W(e,a),!Z(u))return $;x=x&&dn(u,p,l),p=u}else{for(a=0;a<e.length;u>=65536?a+=2:a++){if(u=W(e,a),u===Q)c=!0,h&&(f=f||a-m-1>t&&e[m+1]!==" ",m=a);else if(!Z(u))return $;x=x&&dn(u,p,l),p=u}f=f||h&&a-m-1>t&&e[m+1]!==" "}return!c&&!f?x&&!o&&!r(e)?ri:s===X?$:Fe:i>9&&ti(e)?$:o?s===X?$:Fe:f?si:oi}function Fr(e,n,i,t,r){e.dump=function(){if(n.length===0)return e.quotingType===X?'""':"''";if(!e.noCompatMode&&(br.indexOf(n)!==-1||yr.test(n)))return e.quotingType===X?'"'+n+'"':"'"+n+"'";var s=e.indent*Math.max(1,i),o=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-s),l=t||e.flowLevel>-1&&i>=e.flowLevel;function a(u){return Er(e,u)}switch(Nr(n,l,e.indent,o,a,e.quotingType,e.forceQuotes&&!t,r)){case ri:return n;case Fe:return"'"+n.replace(/'/g,"''")+"'";case oi:return"|"+hn(n,e.indent)+mn(pn(n,s));case si:return">"+hn(n,e.indent)+mn(pn(kr(n,o),s));case $:return'"'+Ir(n)+'"';default:throw new S("impossible error: invalid scalar style")}}()}function hn(e,n){var i=ti(e)?String(n):"",t=e[e.length-1]===`
`,r=t&&(e[e.length-2]===`
`||e===`
`),s=r?"+":t?"":"-";return i+s+`
`}function mn(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function kr(e,n){for(var i=/(\n+)([^\n]*)/g,t=function(){var u=e.indexOf(`
`);return u=u!==-1?u:e.length,i.lastIndex=u,gn(e.slice(0,u),n)}(),r=e[0]===`
`||e[0]===" ",s,o;o=i.exec(e);){var l=o[1],a=o[2];s=a[0]===" ",t+=l+(!r&&!s&&a!==""?`
`:"")+gn(a,n),r=s}return t}function gn(e,n){if(e===""||e[0]===" ")return e;for(var i=/ [^ ]/g,t,r=0,s,o=0,l=0,a="";t=i.exec(e);)l=t.index,l-r>n&&(s=o>r?o:l,a+=`
`+e.slice(r,s),r=s+1),o=l;return a+=`
`,e.length-r>n&&o>r?a+=e.slice(r,o)+`
`+e.slice(o+1):a+=e.slice(r),a.slice(1)}function Ir(e){for(var n="",i=0,t,r=0;r<e.length;i>=65536?r+=2:r++)i=W(e,r),t=A[i],!t&&Z(i)?(n+=e[r],i>=65536&&(n+=e[r+1])):n+=t||wr(i);return n}function _r(e,n,i){var t="",r=e.tag,s,o,l;for(s=0,o=i.length;s<o;s+=1)l=i[s],e.replacer&&(l=e.replacer.call(i,String(s),l)),(I(e,n,l,!1,!1)||typeof l>"u"&&I(e,n,null,!1,!1))&&(t!==""&&(t+=","+(e.condenseFlow?"":" ")),t+=e.dump);e.tag=r,e.dump="["+t+"]"}function xn(e,n,i,t){var r="",s=e.tag,o,l,a;for(o=0,l=i.length;o<l;o+=1)a=i[o],e.replacer&&(a=e.replacer.call(i,String(o),a)),(I(e,n+1,a,!0,!0,!1,!0)||typeof a>"u"&&I(e,n+1,null,!0,!0,!1,!0))&&((!t||r!=="")&&(r+=Ne(e,n)),e.dump&&Q===e.dump.charCodeAt(0)?r+="-":r+="- ",r+=e.dump);e.tag=s,e.dump=r||"[]"}function Rr(e,n,i){var t="",r=e.tag,s=Object.keys(i),o,l,a,u,p;for(o=0,l=s.length;o<l;o+=1)p="",t!==""&&(p+=", "),e.condenseFlow&&(p+='"'),a=s[o],u=i[a],e.replacer&&(u=e.replacer.call(i,a,u)),I(e,n,a,!1,!1)&&(e.dump.length>1024&&(p+="? "),p+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),I(e,n,u,!1,!1)&&(p+=e.dump,t+=p));e.tag=r,e.dump="{"+t+"}"}function Or(e,n,i,t){var r="",s=e.tag,o=Object.keys(i),l,a,u,p,c,f;if(e.sortKeys===!0)o.sort();else if(typeof e.sortKeys=="function")o.sort(e.sortKeys);else if(e.sortKeys)throw new S("sortKeys must be a boolean or a function");for(l=0,a=o.length;l<a;l+=1)f="",(!t||r!=="")&&(f+=Ne(e,n)),u=o[l],p=i[u],e.replacer&&(p=e.replacer.call(i,u,p)),I(e,n+1,u,!0,!0,!0)&&(c=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,c&&(e.dump&&Q===e.dump.charCodeAt(0)?f+="?":f+="? "),f+=e.dump,c&&(f+=Ne(e,n)),I(e,n+1,p,!0,c)&&(e.dump&&Q===e.dump.charCodeAt(0)?f+=":":f+=": ",f+=e.dump,r+=f));e.tag=s,e.dump=r||"{}"}function bn(e,n,i){var t,r,s,o,l,a;for(r=i?e.explicitTypes:e.implicitTypes,s=0,o=r.length;s<o;s+=1)if(l=r[s],(l.instanceOf||l.predicate)&&(!l.instanceOf||typeof n=="object"&&n instanceof l.instanceOf)&&(!l.predicate||l.predicate(n))){if(i?l.multi&&l.representName?e.tag=l.representName(n):e.tag=l.tag:e.tag="?",l.represent){if(a=e.styleMap[l.tag]||l.defaultStyle,Qn.call(l.represent)==="[object Function]")t=l.represent(n,a);else if(Xn.call(l.represent,a))t=l.represent[a](n,a);else throw new S("!<"+l.tag+'> tag resolver accepts not "'+a+'" style');e.dump=t}return!0}return!1}function I(e,n,i,t,r,s,o){e.tag=null,e.dump=i,bn(e,i,!1)||bn(e,i,!0);var l=Qn.call(e.dump),a=t,u;t&&(t=e.flowLevel<0||e.flowLevel>n);var p=l==="[object Object]"||l==="[object Array]",c,f;if(p&&(c=e.duplicates.indexOf(i),f=c!==-1),(e.tag!==null&&e.tag!=="?"||f||e.indent!==2&&n>0)&&(r=!1),f&&e.usedDuplicates[c])e.dump="*ref_"+c;else{if(p&&f&&!e.usedDuplicates[c]&&(e.usedDuplicates[c]=!0),l==="[object Object]")t&&Object.keys(e.dump).length!==0?(Or(e,n,e.dump,r),f&&(e.dump="&ref_"+c+e.dump)):(Rr(e,n,e.dump),f&&(e.dump="&ref_"+c+" "+e.dump));else if(l==="[object Array]")t&&e.dump.length!==0?(e.noArrayIndent&&!o&&n>0?xn(e,n-1,e.dump,r):xn(e,n,e.dump,r),f&&(e.dump="&ref_"+c+e.dump)):(_r(e,n,e.dump),f&&(e.dump="&ref_"+c+" "+e.dump));else if(l==="[object String]")e.tag!=="?"&&Fr(e,e.dump,n,s,a);else{if(l==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new S("unacceptable kind of an object to dump "+l)}e.tag!==null&&e.tag!=="?"&&(u=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?u="!"+u:u.slice(0,18)==="tag:yaml.org,2002:"?u="!!"+u.slice(18):u="!<"+u+">",e.dump=u+" "+e.dump)}return!0}function Lr(e,n){var i=[],t=[],r,s;for(ke(e,i,t),r=0,s=t.length;r<s;r+=1)n.duplicates.push(i[t[r]]);n.usedDuplicates=new Array(s)}function ke(e,n,i){var t,r,s;if(e!==null&&typeof e=="object")if(r=n.indexOf(e),r!==-1)i.indexOf(r)===-1&&i.push(r);else if(n.push(e),Array.isArray(e))for(r=0,s=e.length;r<s;r+=1)ke(e[r],n,i);else for(t=Object.keys(e),r=0,s=t.length;r<s;r+=1)ke(e[t[r]],n,i)}function Pr(e,n){n=n||{};var i=new Ar(n);i.noRefs||Lr(e,i);var t=e;return i.replacer&&(t=i.replacer.call({"":t},"",t)),I(i,0,t,!0,!0)?i.dump+`
`:""}var Br=Pr,Dr={dump:Br};function Pe(e,n){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+n+" instead, which is now safe by default.")}}var Mr=C,Ur=wn,$r=Sn,jr=In,Hr=_n,Vr=_e,Yr=Kn.load,qr=Kn.loadAll,zr=Dr.dump,Gr=S,Wr={binary:Bn,float:kn,map:En,null:Tn,pairs:Mn,set:Un,timestamp:Ln,bool:Nn,int:Fn,merge:Pn,omap:Dn,seq:An,str:Cn},Kr=Pe("safeLoad","load"),Qr=Pe("safeLoadAll","loadAll"),Xr=Pe("safeDump","dump"),li={Type:Mr,Schema:Ur,FAILSAFE_SCHEMA:$r,JSON_SCHEMA:jr,CORE_SCHEMA:Hr,DEFAULT_SCHEMA:Vr,load:Yr,loadAll:qr,dump:zr,YAMLException:Gr,types:Wr,safeLoad:Kr,safeLoadAll:Qr,safeDump:Xr};function ce(e){let n=e.trim();if(!n)return null;try{let i=li.load(n);return!i||typeof i!="object"?null:i}catch{return null}}function ai(e){let n=[],i=/```base\s*\n([\s\S]*?)```/g,t;for(;(t=i.exec(e))!==null;)n.push({fullMatch:t[0],yaml:t[1],start:t.index,end:t.index+t[0].length});return n}function ui(e){let n=[],i=/!\[\[([^\]#]+\.base)(?:#([^\]]+))?\]\]/g,t;for(;(t=i.exec(e))!==null;)n.push({fullMatch:t[0],filename:t[1],viewName:t[2]||void 0,start:t.index,end:t.index+t[0].length});return n}function Y(e){return/```base\s*\n|!\[\[[^\]]+\.base/.test(e)}function Be(e){let n=e.indexOf(".");if(n===-1)return{type:"note",name:e};let i=e.slice(0,n),t=e.slice(n+1);return{type:i,name:t}}function ci(e){return typeof e=="object"&&e!==null}function Zr(e){let n=[],i=0;for(;i<e.length;){if(/\s/.test(e[i])){i++;continue}if(e.slice(i,i+2).match(/^(==|!=|>=|<=)$/)){n.push({type:"OPERATOR",value:e.slice(i,i+2),raw:e.slice(i,i+2)}),i+=2;continue}if(e[i]===">"||e[i]==="<"){n.push({type:"OPERATOR",value:e[i],raw:e[i]}),i++;continue}if(e[i]==="."){n.push({type:"DOT",value:".",raw:"."}),i++;continue}if(e[i]==="("){n.push({type:"LPAREN",value:"(",raw:"("}),i++;continue}if(e[i]===")"){n.push({type:"RPAREN",value:")",raw:")"}),i++;continue}if(e[i]===","){n.push({type:"COMMA",value:",",raw:","}),i++;continue}if(e[i]==='"'||e[i]==="'"){let t=e[i],r="",s=i;for(i++;i<e.length&&e[i]!==t;)e[i]==="\\"&&i+1<e.length?(r+=e[i+1],i+=2):(r+=e[i],i++);i++,n.push({type:"STRING",value:r,raw:e.slice(s,i)});continue}if(/[0-9]/.test(e[i])||e[i]==="-"&&/[0-9]/.test(e[i+1]||"")){let t="",r=i;for(e[i]==="-"&&(t+=e[i],i++);i<e.length&&/[0-9.]/.test(e[i]);)t+=e[i],i++;n.push({type:"NUMBER",value:parseFloat(t),raw:e.slice(r,i)});continue}if(/[a-zA-Z_]/.test(e[i])){let t="",r=i;for(;i<e.length&&/[a-zA-Z0-9_]/.test(e[i]);)t+=e[i],i++;t==="true"?n.push({type:"BOOLEAN",value:!0,raw:t}):t==="false"?n.push({type:"BOOLEAN",value:!1,raw:t}):t==="null"?n.push({type:"NULL",value:null,raw:t}):n.push({type:"IDENTIFIER",value:t,raw:t});continue}i++}return n.push({type:"EOF",value:null,raw:""}),n}var De=class{tokens;pos=0;constructor(n){this.tokens=n}peek(){return this.tokens[this.pos]||{type:"EOF",value:null,raw:""}}consume(){return this.tokens[this.pos++]||{type:"EOF",value:null,raw:""}}expect(n){let i=this.consume();if(i.type!==n)throw new Error(`Expected ${n}, got ${i.type}`);return i}parse(){return this.parseExpression()}parseExpression(){return this.parseComparison()}parseComparison(){let n=this.parseMemberOrCall();if(this.peek().type==="OPERATOR"){let i=this.consume().value,t=this.parseMemberOrCall();return{type:"binary",operator:i,left:n,right:t}}return n}parseMemberOrCall(){let n=this.parsePrimary();for(;;)if(this.peek().type==="DOT"){this.consume();let i=this.expect("IDENTIFIER").value;n={type:"member",object:n,property:i}}else if(this.peek().type==="LPAREN"){this.consume();let i=[];if(this.peek().type!=="RPAREN")for(i.push(this.parseExpression());this.peek().type==="COMMA";)this.consume(),i.push(this.parseExpression());this.expect("RPAREN"),n={type:"call",callee:n,args:i}}else break;return n}parsePrimary(){let n=this.peek();if(n.type==="STRING"||n.type==="NUMBER"||n.type==="BOOLEAN"||n.type==="NULL")return this.consume(),{type:"literal",value:n.value};if(n.type==="IDENTIFIER")return this.consume(),{type:"identifier",name:n.value};if(n.type==="LPAREN"){this.consume();let i=this.parseExpression();return this.expect("RPAREN"),i}throw new Error(`Unexpected token: ${n.type}`)}};function q(e,n){switch(e.type){case"literal":return e.value;case"identifier":return n.properties[e.name];case"member":{if(e.object.type==="identifier"&&e.object.name==="file")return Jr(e.property,n);if(e.object.type==="identifier"&&e.object.name==="note")return n.properties[e.property];let i=q(e.object,n);return i&&typeof i=="object"&&e.property in i?i[e.property]:void 0}case"call":return eo(e.callee,e.args,n);case"binary":{let i=q(e.left,n),t=q(e.right,n);return ro(e.operator,i,t,e.left)}}}function Jr(e,n){switch(e){case"name":return n.title;case"folder":return n.folder;case"path":return`${n.folder}/${n.title}`;case"ext":return n.ext;case"ctime":return n.ctime;case"mtime":return n.mtime;case"size":return n.size;default:return}}function eo(e,n,i){if(e.type==="member"&&e.object.type==="identifier"&&e.object.name==="file"){let t=e.property;if(t==="hasTag"&&n.length===1){let s=String(n[0].type==="literal"?n[0].value:"").toLowerCase().replace(/^#/,"");return i.tags.some(o=>o.toLowerCase().replace(/^#/,"")===s)}if(t==="inFolder"&&n.length===1){let r=String(n[0].type==="literal"?n[0].value:"");return no(i.folder,r)}if(t==="hasLink"&&n.length===1){let r=String(n[0].type==="literal"?n[0].value:"");return i.links.some(s=>s.toLowerCase()===r.toLowerCase())}if(t==="hasProperty"&&n.length===1){let r=String(n[0].type==="literal"?n[0].value:"");return r in i.properties&&i.properties[r]!==void 0}}if(e.type==="member"&&e.property==="contains"){let t=q(e.object,i);if(n.length===1){let r=n[0];if(r.type==="call"&&r.callee.type==="identifier"&&r.callee.name==="link"&&r.args.length===1){let o=String(r.args[0].type==="literal"?r.args[0].value:"");return io(t,o)}let s=String(r.type==="literal"?r.value:q(r,i));return to(t,s)}}return e.type==="identifier"&&e.name==="link"&&n.length===1?{__link:String(n[0].type==="literal"?n[0].value:"")}:!1}function no(e,n){let i=e.toLowerCase(),t=n.toLowerCase();return i===t||i.startsWith(`${t}/`)?!0:i.split("/").some(s=>s===t)}function io(e,n){if(e==null)return!1;let i=n.toLowerCase(),t=r=>{let s=String(r),o=s.match(/\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/);return o?o[1].toLowerCase()===i:s.toLowerCase()===i};return Array.isArray(e)?e.some(t):t(e)}function to(e,n){if(e==null)return!1;let i=n.toLowerCase();return Array.isArray(e)?e.some(t=>String(t).toLowerCase().includes(i)):String(e).toLowerCase().includes(i)}function ro(e,n,i,t){let r=t.type==="member"&&t.object.type==="identifier"&&t.object.name==="file"&&t.property==="folder";if(i===null){if(e==="==")return n==null;if(e==="!=")return n!=null}if(n==null)return e==="=="&&i===null;if(typeof i=="string"){let s=String(n),o=i;switch(r&&(s=s.toLowerCase(),o=o.toLowerCase()),e){case"==":return s===o;case"!=":return s!==o;case">":return s>o;case"<":return s<o;case">=":return s>=o;case"<=":return s<=o}}if(typeof i=="number"){let s=Number(n);if(Number.isNaN(s))return!1;switch(e){case"==":return s===i;case"!=":return s!==i;case">":return s>i;case"<":return s<i;case">=":return s>=i;case"<=":return s<=i}}if(typeof i=="boolean")switch(e){case"==":return n===i;case"!=":return n!==i}return!1}function pi(e,n){try{let i=Zr(e),r=new De(i).parse();return!!q(r,n)}catch{return!1}}function Me(e,n,i={}){let t=e;return i.publishedOnly&&(t=t.filter(r=>r.isPublished)),n===void 0?t:t.filter(r=>J(n,r))}function J(e,n){if(typeof e=="string")return oo(e,n);if(ci(e)){if("and"in e)return e.and.every(i=>J(i,n));if("or"in e)return e.or.some(i=>J(i,n));if("not"in e)return!e.not.some(i=>J(i,n))}return!1}function oo(e,n){let i=e.trim();return i?pi(i,n):!1}function $e(e,n,i={}){let t=so(e,i);if(!t){let s=i.viewName??i.viewIndex?.toString()??"default";return ao(`View not found: ${s}`)}if(n.length===0)return uo();let r;switch(t.type){case"table":r=Ue(n,t,i,e);break;case"card":r=di(n,t,i);break;case"list":r=hi(n,t,i);break;default:r=Ue(n,t,i,e)}return`<div class="base-view">${r}</div>`}function so(e,n){if(!(!e.views||e.views.length===0))return n.viewName?e.views.find(i=>i.name===n.viewName):n.viewIndex!==void 0?e.views[n.viewIndex]:e.views[0]}function Ue(e,n,i={},t){let r=n.order??["file.name"],s=n.limit?e.slice(0,n.limit):e,o=r.map(a=>{let u=gi(a,t);return`<th>${N(u)}</th>`}),l=s.map(a=>`<tr>${r.map(p=>{let c=mi(p,a),f=je(c);return p==="file.name"&&i.publishedSlugs?.has(a.slug)?`<td><a href="/${a.slug}">${N(f)}</a></td>`:`<td>${N(f)}</td>`}).join("")}</tr>`);return`<table class="base-table">
<thead><tr>${o.join("")}</tr></thead>
<tbody>${l.join(`
`)}</tbody>
</table>`}function di(e,n,i={}){let t=n.order??["file.name"];return`<div class="base-cards">${(n.limit?e.slice(0,n.limit):e).map(o=>{let l=o.title,a=i.publishedSlugs?.has(o.slug)?`<a href="/${o.slug}">${N(l)}</a>`:N(l),p=t.filter(c=>c!=="file.name").map(c=>{let f=mi(c,o),h=je(f),m=gi(c);return`<div class="base-card-prop"><span class="base-card-label">${N(m)}:</span> ${N(h)}</div>`}).join(`
`);return`<div class="base-card">
<div class="base-card-title">${a}</div>
${p}
</div>`}).join(`
`)}</div>`}function hi(e,n,i={}){return`<ul class="base-list">${(n.limit?e.slice(0,n.limit):e).map(s=>{let o=s.title;return`<li>${i.publishedSlugs?.has(s.slug)?`<a href="/${s.slug}">${N(o)}</a>`:N(o)}</li>`}).join(`
`)}</ul>`}function mi(e,n){let{type:i,name:t}=Be(e);switch(i){case"file":return lo(t,n);case"note":return n.properties[t];case"formula":return;default:return n.properties[e]}}function lo(e,n){switch(e){case"name":return n.title;case"folder":return n.folder;case"ext":return n.ext;case"ctime":return n.ctime;case"mtime":return n.mtime;case"size":return n.size;case"path":return`${n.folder}/${n.title}`;default:return}}function je(e){return e==null?"":typeof e=="boolean"?e?"Yes":"No":typeof e=="number"?e>9466848e5?new Date(e).toLocaleDateString():e.toString():Array.isArray(e)?e.map(n=>je(n)).join(", "):String(e)}function gi(e,n){if(n?.properties?.[e]?.displayName)return n.properties[e].displayName;let{type:i,name:t}=Be(e);if(i==="file")switch(t){case"name":return"Name";case"folder":return"Folder";case"ext":return"Extension";case"ctime":return"Created";case"mtime":return"Modified";case"size":return"Size";case"path":return"Path";default:return fi(t)}return fi(t)}function ao(e){return`<div class="base-error">${N(e)}</div>`}function uo(){return'<div class="base-empty">No results</div>'}function fi(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)}function xi(e,n,i,t){let r=[];if(n?.frontmatter?.tags){let a=n.frontmatter.tags;Array.isArray(a)?r.push(...a.map(u=>u.startsWith("#")?u:`#${u}`)):typeof a=="string"&&r.push(a.startsWith("#")?a:`#${a}`)}if(n?.tags)for(let a of n.tags)r.includes(a.tag)||r.push(a.tag);let s=[];if(n?.links)for(let a of n.links)s.includes(a.link)||s.push(a.link);let o=e.parent?.path??"",l={};if(n?.frontmatter)for(let[a,u]of Object.entries(n.frontmatter))a==="position"||a==="tags"||(l[a]=u);return{file:e,slug:U(e),title:e.basename,tags:r,folder:o,properties:l,links:s,ctime:e.stat.ctime,mtime:e.stat.mtime,ext:e.extension,size:e.stat.size,isPublished:t}}async function He(e,n){let i=e.vault.getMarkdownFiles(),t=[];for(let r of i){if(r.path.startsWith(".trash/")||r.path.startsWith(".obsidian/"))continue;let s=await e.vault.cachedRead(r),o=e.metadataCache.getFileCache(r),l=U(r),a=n.has(l);t.push(xi(r,o,s,a))}return t}function Ve(e){return new Set(e.map(n=>U(n)))}async function qe(e,n,i,t){if(!Y(e))return e;let r=e,s=ui(e);for(let l of s.reverse()){let a=await co(l.filename,l.viewName,n,i,t);r=r.slice(0,l.start)+a+r.slice(l.end)}let o=ai(r);for(let l of o.reverse()){let a=fo(l.yaml,i,t);r=r.slice(0,l.start)+a+r.slice(l.end)}return r}async function co(e,n,i,t,r){let s=po(i,e);if(!s)return Ye(`Base file not found: ${e}`);let o=await i.vault.cachedRead(s),l=ce(o);return l?bi(l,t,r,{viewName:n}):Ye(`Failed to parse base file: ${e}`)}function po(e,n){let i=e.vault.getFiles();for(let r of i)if(r.path===n||r.path===`${n}`)return r;let t=n.split("/").pop()||n;for(let r of i)if(r.name===t&&r.extension==="base")return r;return null}function fo(e,n,i){let t=ce(e);return t?bi(t,n,i,{}):Ye("Failed to parse inline base")}function bi(e,n,i,t){let r=ho(e,t),s=e.filters;r?.filters&&(s?s={and:[s,r.filters]}:s=r.filters);let o=Me(n,s,{publishedOnly:i.hideUnpublished});return $e(e,o,{publishedSlugs:i.publishedSlugs,viewName:t.viewName,viewIndex:t.viewIndex})}function ho(e,n){if(!(!e.views||e.views.length===0))return n.viewName?e.views.find(i=>i.name===n.viewName):n.viewIndex!==void 0?e.views[n.viewIndex]:e.views[0]}function Ye(e){return`<div class="base-error">${N(e)}</div>`}async function mo(e,n,i,t,r){r?.("Checking existing images on server...");let s={};try{s=(await n.getImages(i)).images}catch(u){console.error("Failed to fetch server images:",u)}let o=new Set(Object.keys(s)),l=[],a=new Set;for(let u of t){let p=await e.vault.cachedRead(u),c=nn(p);for(let f of c)a.add(f)}for(let u of a){if(o.has(u))continue;let p=tn(e,u);p&&l.push({filename:u,file:p})}for(let u=0;u<l.length;u++){let{filename:p,file:c}=l[u];r?.(`Uploading image ${u+1}/${l.length}: ${p}`);try{let f=await e.vault.readBinary(c);await n.uploadImage(i,f,p)}catch(f){console.error(`[Pubit] Failed to upload image ${p}:`,f)}}}async function yi(e,n,i,t,r="publish",s={}){let o=[],l=s.hideUnpublishedInBases??!0;try{t?.("Collecting local notes...",5);let a=await Je(e,r),u=Ve(a);t?.("Fetching remote state...",10);let p=await n.getNotes(i),c=new Map(p.map(y=>[y.slug,y.contentHash])),f=new Set(p.filter(y=>y.needsPathSync).map(y=>y.slug));t?.("Syncing images...",15),await mo(e,n,i,a,y=>t?.(y,20)),t?.("Checking for bases...",22);let h=null,m=!1;for(let y of a){let E=await e.vault.cachedRead(y);if(Y(E)){m=!0;break}}m&&(t?.("Building vault context for bases...",24),h=await He(e,u)),t?.("Computing changes...",25);let x=[],b=[],T=new Set,g=0;for(let y of a){let E=U(y),_=en(y),me=y.path.replace(/\.md$/,""),R=await e.vault.cachedRead(y);h&&Y(R)&&(R=await qe(R,e,h,{publishedSlugs:u,hideUnpublished:l}));let wi=await be(R);T.add(E);let ze=c.get(E);!ze||ze!==wi||f.has(E)?x.push({slug:E,title:_,content:R,originalPath:me}):g++}for(let[y]of c)T.has(y)||b.push(y);let de=0;if(x.length>0){let y=x.length;for(let E=0;E<x.length;E++){let _=x[E],me=30+E/y*40;t?.(`Uploading ${E+1}/${y}: ${_.slug.split("/").pop()}...`,me);try{await n.uploadNote(i,_.slug,_.title,_.content,_.originalPath),de++}catch(R){o.push(`Upload failed: ${_.slug} - ${R instanceof Error?R.message:"Unknown"}`)}}}let he=0;if(b.length>0){t?.(`Deleting ${b.length} orphaned notes...`,75);for(let y of b)try{await n.deleteNote(i,y),he++}catch(E){o.push(`Delete failed: ${y} - ${E instanceof Error?E.message:"Unknown"}`)}}if(de>0||he>0){t?.("Publishing...",85);let y=await n.publish(i);return{success:o.length===0,uploaded:de,deleted:he,unchanged:g,errors:o,siteUrl:y.url}}t?.("Publishing...",90);let vi=await n.publish(i);return{success:!0,uploaded:0,deleted:0,unchanged:a.length,errors:[],siteUrl:vi.url}}catch(a){return{success:!1,uploaded:0,deleted:0,unchanged:0,errors:[a instanceof Error?a.message:"Unknown error"]}}}var pe=class extends fe.Plugin{settings=G;api=null;statusBarItem=null;settingsTab=null;ribbonIcon=null;hasPendingChanges=!1;styleEl=null;async onload(){await this.loadSettings(),this.api=new z(we,this.settings.apiToken),this.registerStyles(),this.ribbonIcon=this.addRibbonIcon("upload-cloud","Publish notes",async()=>{await this.publish()}),this.registerEvent(this.app.vault.on("modify",()=>this.markPendingChanges())),this.registerEvent(this.app.vault.on("create",()=>this.markPendingChanges())),this.registerEvent(this.app.vault.on("delete",()=>this.markPendingChanges())),this.registerEvent(this.app.vault.on("rename",()=>this.markPendingChanges())),this.addCommand({id:"publish-sync",name:"Sync and publish",callback:async()=>{await this.publish()}}),this.addCommand({id:"publish-connect",name:"Connect vault",callback:async()=>{await this.startDeviceCodeFlow()}}),this.addCommand({id:"publish-disconnect",name:"Disconnect vault",callback:async()=>{await this.disconnect()}}),this.settingsTab=new te(this.app,this),this.addSettingTab(this.settingsTab),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar()}async loadSettings(){this.settings=Object.assign({},G,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.api&&(this.api=new z(we,this.settings.apiToken)),this.updateStatusBar()}showNotice(n){new fe.Notice(n)}updateStatusBar(){this.statusBarItem&&(this.settings.apiToken?this.hasPendingChanges?(this.statusBarItem.setText("Publish: Changes pending"),this.statusBarItem.setAttribute("aria-label","Click ribbon icon to sync")):(this.statusBarItem.setText("Publish: Up to date"),this.statusBarItem.setAttribute("aria-label","All synced")):(this.statusBarItem.setText("Publish: Not connected"),this.statusBarItem.setAttribute("aria-label","Click to connect")))}markPendingChanges(){this.settings.apiToken&&(this.hasPendingChanges||(this.hasPendingChanges=!0,this.updatePendingIndicator(),this.updateStatusBar()))}clearPendingChanges(){this.hasPendingChanges=!1,this.updatePendingIndicator(),this.updateStatusBar()}updatePendingIndicator(){this.ribbonIcon&&(this.hasPendingChanges?(this.ribbonIcon.addClass("has-pending-changes"),this.ribbonIcon.setAttribute("aria-label","Publish notes (changes pending)")):(this.ribbonIcon.removeClass("has-pending-changes"),this.ribbonIcon.setAttribute("aria-label","Publish notes")))}registerStyles(){this.styleEl=document.createElement("style"),this.styleEl.id="publish-plugin-styles",this.styleEl.textContent=`
			.side-dock-ribbon-action.has-pending-changes::after {
				content: '';
				position: absolute;
				top: 6px;
				right: 6px;
				width: 8px;
				height: 8px;
				background: var(--color-accent);
				border-radius: 50%;
				border: 2px solid var(--background-primary);
			}
			
			.side-dock-ribbon-action.has-pending-changes {
				position: relative;
			}
		`,document.head.appendChild(this.styleEl)}onunload(){this.styleEl&&this.styleEl.remove()}async startDeviceCodeFlow(){if(!this.api){this.showNotice("Plugin not initialized");return}try{let n=await this.api.getDeviceCode();new ee(this.app,n.code,n.verificationUrl,this.api,async t=>{this.settings.apiToken=t.token,this.settings.userEmail=t.email,this.settings.siteId=t.siteId,this.settings.subdomain=t.subdomain,await this.saveSettings(),this.api?.setToken(t.token),this.settingsTab?.display();let r=t.subdomain?` Your site: ${t.subdomain}.pubit.site`:"";this.showNotice(`Successfully connected!${r}`)},()=>{}).open()}catch(n){this.showNotice(`Failed to start connection: ${n instanceof Error?n.message:"Unknown error"}`)}}async disconnect(){if(!this.api||!this.settings.apiToken){this.showNotice("Not connected");return}let n=this.settings.subdomain;try{await this.api.revokeToken()}catch{}this.settings.apiToken=void 0,this.settings.siteId=void 0,this.settings.userEmail=void 0,this.settings.subdomain=void 0,await this.saveSettings(),n?this.showNotice(`Disconnected. Your site remains online at ${n}.pubit.site. To delete it, visit the dashboard.`):this.showNotice("Disconnected")}async publish(){if(!this.api){this.showNotice("Plugin not initialized");return}if(!this.settings.apiToken){this.showNotice("Please connect your vault first"),await this.startDeviceCodeFlow();return}if(!this.settings.siteId){this.showNotice("No site configured. Please disconnect and reconnect.");return}let n=new ie(this.app);n.open();try{let i=await this.api.getSite(this.settings.siteId),t=await yi(this.app,this.api,this.settings.siteId,(r,s)=>{n.setStatus(r),s!==void 0&&n.setProgress(s)},this.settings.publishTag||"publish",{hideUnpublishedInBases:i.hideUnpublishedInBases});t.success?(n.showSuccess(t.siteUrl||"",{uploaded:t.uploaded,deleted:t.deleted,unchanged:t.unchanged}),this.clearPendingChanges()):n.showError(t.errors.join(`
`))}catch(i){n.showError(i instanceof Error?i.message:"Unknown error")}}async createSite(){if(this.api)return new Promise(n=>{new ne(this.app,this.api,"pubit.site",async(t,r)=>{this.settings.siteId=t,this.settings.subdomain=r,await this.saveSettings(),this.showNotice(`Site created: ${r}.pubit.site`),n()},()=>{n()}).open()})}async changeSubdomain(){if(!this.api){this.showNotice("Plugin not initialized");return}if(!this.settings.apiToken){this.showNotice("Please connect your vault first");return}this.showNotice("Subdomain change coming soon! For now, disconnect and reconnect to get a new subdomain.")}};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
