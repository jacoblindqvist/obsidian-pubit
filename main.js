"use strict";var he=Object.defineProperty;var bn=Object.getOwnPropertyDescriptor;var vn=Object.getOwnPropertyNames;var yn=Object.prototype.hasOwnProperty;var Cn=(e,i)=>{for(var n in i)he(e,n,{get:i[n],enumerable:!0})},wn=(e,i,n,r)=>{if(i&&typeof i=="object"||typeof i=="function")for(let t of vn(i))!yn.call(e,t)&&t!==n&&he(e,t,{get:()=>i[t],enumerable:!(r=bn(i,t))||r.enumerable});return e};var En=e=>wn(he({},"__esModule",{value:!0}),e);var co={};Cn(co,{default:()=>ce});module.exports=En(co);var pe=require("obsidian");var q=class{baseUrl;token;constructor(i,n){this.baseUrl=i,this.token=n||null}setToken(i){this.token=i}async request(i,n,r,t=!1){let s={};this.token&&(s.Authorization=`Bearer ${this.token}`),r&&!t&&(s["Content-Type"]="application/json");let o=0,l=5;for(;o<l;)try{let a=await fetch(`${this.baseUrl}${n}`,{method:i,headers:s,body:t?r:r?JSON.stringify(r):void 0});if(!a.ok){let u=await a.json().catch(()=>({message:"Request failed"}));if(a.status===429){let p=a.headers.get("Retry-After"),c=p?Number.parseInt(p,10)*1e3:2**o*1e3;if(o++,o>=l)throw new O("RATE_LIMITED","Rate limited. Try again later.",429);await new Promise(f=>setTimeout(f,Math.min(c,3e4)));continue}throw a.status>=400&&a.status<500?new O(u.code||"ERROR",u.message,a.status):new O(u.code||"SERVER_ERROR",u.message||"Server error",a.status)}return a.json()}catch(a){if(a instanceof O&&a.status>=400&&a.status<500||(o++,o>=l))throw a;await new Promise(u=>setTimeout(u,2**o*1e3))}throw new Error("Max retries exceeded")}async getDeviceCode(){return this.request("POST","/auth/device-code")}async pollDeviceCode(i){return this.request("GET",`/auth/poll/${i}`)}async revokeToken(){return this.request("POST","/auth/revoke")}async getSites(){return this.request("GET","/sites")}async createSite(i){return this.request("POST","/sites",{subdomain:i})}async getSite(i){return this.request("GET",`/sites/${i}`)}async getNotes(i){return this.request("GET",`/sites/${i}/notes`)}async uploadNote(i,n,r,t,s){let o={"Content-Type":"text/markdown; charset=utf-8","X-Note-Title":encodeURIComponent(r)};s&&(o["X-Original-Path"]=encodeURIComponent(s)),this.token&&(o.Authorization=`Bearer ${this.token}`);let l=5;for(let a=0;a<l;a++){let u=await fetch(`${this.baseUrl}/sites/${i}/notes/${n}`,{method:"PUT",headers:o,body:t});if(u.ok)return u.json();if(u.status===429){let c=u.headers.get("Retry-After"),f=c?Number.parseInt(c,10)*1e3:2**a*1e3;await new Promise(h=>setTimeout(h,Math.min(f,3e4)));continue}let p=await u.json().catch(()=>({message:"Upload failed"}));throw new O(p.code||"UPLOAD_FAILED",p.message,u.status)}throw new O("RATE_LIMITED","Rate limited after multiple retries",429)}async deleteNote(i,n){return this.request("DELETE",`/sites/${i}/notes/${n}`)}async getImages(i){return this.request("GET",`/sites/${i}/images`)}async uploadImage(i,n,r){let t=new FormData,s=new Blob([n],{type:this.getMimeType(r)});return t.append("image",s,r),this.request("POST",`/sites/${i}/images`,t,!0)}async publish(i,n=!1){let r=n?"?force=true":"";return this.request("POST",`/sites/${i}/publish${r}`)}getMimeType(i){let n=i.split(".").pop()?.toLowerCase();return{png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",webp:"image/webp",svg:"image/svg+xml"}[n||""]||"application/octet-stream"}},O=class extends Error{code;status;constructor(i,n,r){super(n),this.code=i,this.status=r,this.name="ApiError"}};var Ye=require("obsidian"),J=class extends Ye.Modal{code;verificationUrl;api;pollInterval=null;onSuccess;onCancel;constructor(i,n,r,t,s,o){super(i),this.code=n,this.verificationUrl=r,this.api=t,this.onSuccess=s,this.onCancel=o}onOpen(){let{contentEl:i}=this;i.empty(),i.addClass("publish-device-code-modal"),i.createEl("h2",{text:"Connect Your Vault"}),i.createDiv({cls:"publish-instructions"}).createEl("p",{text:"Enter this code in your browser to connect:"}),i.createDiv({cls:"publish-code-display"}).createEl("span",{text:this.code,cls:"publish-code"});let t=i.createDiv({cls:"publish-button-container"}),s=t.createEl("button",{text:"Copy Code",cls:"mod-cta"});s.addEventListener("click",()=>{navigator.clipboard.writeText(this.code),s.textContent="Copied!",setTimeout(()=>{s.textContent="Copy Code"},2e3)}),t.createEl("button",{text:"Open in Browser"}).addEventListener("click",()=>{window.open(this.verificationUrl,"_blank")});let l=i.createDiv({cls:"publish-status"});l.createEl("p",{text:"Waiting for authorization..."}),i.createEl("button",{text:"Cancel",cls:"publish-cancel-button"}).addEventListener("click",()=>{this.close(),this.onCancel()}),this.startPolling(l),this.addStyles()}startPolling(i){this.pollInterval=setInterval(async()=>{try{let n=await this.api.pollDeviceCode(this.code);n.status==="completed"&&n.token?(this.stopPolling(),i.empty(),i.createEl("p",{text:"Connected successfully!",cls:"publish-status-success"}),setTimeout(()=>{this.close(),this.onSuccess({token:n.token,email:n.email||"",siteId:n.siteId,subdomain:n.subdomain})},1e3)):n.status==="expired"&&(this.stopPolling(),i.empty(),i.createEl("p",{text:"Code expired. Please try again.",cls:"publish-status-error"}))}catch{}},2e3)}stopPolling(){this.pollInterval&&(clearInterval(this.pollInterval),this.pollInterval=null)}onClose(){this.stopPolling();let{contentEl:i}=this;i.empty()}addStyles(){let i=document.createElement("style");i.textContent=`
			.publish-device-code-modal {
				padding: 20px;
				text-align: center;
			}
			.publish-device-code-modal h2 {
				margin-bottom: 16px;
			}
			.publish-instructions {
				margin-bottom: 20px;
				color: var(--text-muted);
			}
			.publish-code-display {
				background: var(--background-secondary);
				border-radius: 8px;
				padding: 20px;
				margin-bottom: 20px;
			}
			.publish-code {
				font-family: var(--font-monospace);
				font-size: 2em;
				font-weight: bold;
				letter-spacing: 0.2em;
			}
			.publish-button-container {
				display: flex;
				gap: 10px;
				justify-content: center;
				margin-bottom: 20px;
			}
			.publish-button-container button {
				padding: 8px 16px;
			}
			.publish-status {
				margin-bottom: 16px;
				color: var(--text-muted);
			}
			.publish-status-success {
				color: var(--text-success);
			}
			.publish-status-error {
				color: var(--text-error);
			}
			.publish-cancel-button {
				color: var(--text-muted);
			}
		`,this.contentEl.appendChild(i)}};function me(e){if(!e||typeof e!="string")return"";let i=e.toLowerCase().trim(),n={\u00E4:"ae",\u00F6:"oe",\u00FC:"ue",\u00DF:"ss",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E5:"a",\u00E6:"ae",\u00E7:"c",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00F1:"n",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F8:"o",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FD:"y",\u00FF:"y",\u00F0:"d",\u00FE:"th"};for(let[r,t]of Object.entries(n))i=i.replace(new RegExp(r,"g"),t);return i=i.replace(/[\s_]+/g,"-"),i=i.replace(/[^a-z0-9-]/g,""),i=i.replace(/-+/g,"-"),i=i.replace(/^-+|-+$/g,""),i||"untitled"}async function ge(e){let n=new TextEncoder().encode(e),r=await crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(r)).map(o=>o.toString(16).padStart(2,"0")).join("")}var qe=new Set(["www","api","app","admin","dashboard","help","support","blog","docs","status","mail","smtp","pop","imap","ftp","cdn","assets","static","img","images","js","css","auth","login","register","signup","signin","account","billing","payment","dev","staging","test","demo","portal"]),An=/^[a-z][a-z0-9-]{1,28}[a-z0-9]$/;function xe(e){return!(!e||typeof e!="string"||!An.test(e)||e.includes("--"))}function be(e){return qe.has(e.toLowerCase())}function F(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var Ge=require("obsidian"),ee=class extends Ge.Modal{api;serviceDomain;onSuccess;onCancel;constructor(i,n,r,t,s){super(i),this.api=n,this.serviceDomain=r,this.onSuccess=t,this.onCancel=s}onOpen(){let{contentEl:i}=this;i.empty(),i.addClass("publish-subdomain-modal"),i.createEl("h2",{text:"Choose Your Site URL"}),i.createDiv({cls:"publish-instructions"}).createEl("p",{text:"Pick a unique subdomain for your published notes:"});let r=i.createDiv({cls:"publish-subdomain-input"}),t=r.createEl("input",{type:"text",placeholder:"my-notes",cls:"publish-subdomain-field"});r.createEl("span",{text:`.${this.serviceDomain}`,cls:"publish-domain-suffix"});let s=i.createDiv({cls:"publish-url-preview"});s.createEl("span",{text:"Your site will be at: "});let o=s.createEl("span",{cls:"publish-preview-url",text:`https://your-subdomain.${this.serviceDomain}`}),l=i.createDiv({cls:"publish-feedback"}),a=i.createDiv({cls:"publish-button-container"}),u=a.createEl("button",{text:"Create Site",cls:"mod-cta"});u.disabled=!0;let p=a.createEl("button",{text:"Cancel"});t.addEventListener("input",()=>{let c=t.value.toLowerCase().trim();if(o.textContent=c?`https://${c}.${this.serviceDomain}`:`https://your-subdomain.${this.serviceDomain}`,l.empty(),u.disabled=!0,!!c){if(!xe(c)){l.createEl("p",{text:"Must be 3-30 characters, start with a letter, and contain only lowercase letters, numbers, and hyphens.",cls:"publish-feedback-error"});return}if(be(c)){l.createEl("p",{text:"This subdomain is reserved.",cls:"publish-feedback-error"});return}l.createEl("p",{text:"Looks good!",cls:"publish-feedback-success"}),u.disabled=!1}}),u.addEventListener("click",async()=>{let c=t.value.toLowerCase().trim();u.disabled=!0,u.textContent="Creating...",l.empty();try{let f=await this.api.createSite(c);this.close(),this.onSuccess(f.id,f.subdomain)}catch(f){u.disabled=!1,u.textContent="Create Site",l.empty(),l.createEl("p",{text:f instanceof Error?f.message:"Failed to create site",cls:"publish-feedback-error"})}}),p.addEventListener("click",()=>{this.close(),this.onCancel()}),this.addStyles(),t.focus()}onClose(){let{contentEl:i}=this;i.empty()}addStyles(){let i=document.createElement("style");i.textContent=`
			.publish-subdomain-modal {
				padding: 20px;
			}
			.publish-subdomain-modal h2 {
				margin-bottom: 16px;
				text-align: center;
			}
			.publish-instructions {
				margin-bottom: 20px;
				color: var(--text-muted);
				text-align: center;
			}
			.publish-subdomain-input {
				display: flex;
				align-items: center;
				background: var(--background-secondary);
				border-radius: 8px;
				padding: 8px 12px;
				margin-bottom: 12px;
			}
			.publish-subdomain-field {
				flex: 1;
				border: none;
				background: transparent;
				font-size: 1.1em;
				padding: 8px;
				outline: none;
			}
			.publish-domain-suffix {
				color: var(--text-muted);
				font-size: 1.1em;
			}
			.publish-url-preview {
				text-align: center;
				margin-bottom: 12px;
				font-size: 0.9em;
				color: var(--text-muted);
			}
			.publish-preview-url {
				color: var(--text-accent);
			}
			.publish-feedback {
				min-height: 24px;
				margin-bottom: 16px;
				text-align: center;
			}
			.publish-feedback-error {
				color: var(--text-error);
				margin: 0;
			}
			.publish-feedback-success {
				color: var(--text-success);
				margin: 0;
			}
			.publish-button-container {
				display: flex;
				gap: 10px;
				justify-content: center;
			}
			.publish-button-container button {
				padding: 8px 20px;
			}
		`,this.contentEl.appendChild(i)}};var We=require("obsidian"),ie=class extends We.Modal{statusEl=null;progressEl=null;detailsEl=null;closeButton=null;cancelled=!1;onOpen(){let{contentEl:i}=this;i.empty(),i.addClass("publish-sync-modal"),i.createEl("h2",{text:"Publishing Notes"}),this.progressEl=i.createDiv({cls:"publish-progress"}),this.progressEl.createDiv({cls:"publish-progress-bar"}),this.statusEl=i.createDiv({cls:"publish-sync-status"}),this.statusEl.createEl("p",{text:"Starting..."}),this.detailsEl=i.createDiv({cls:"publish-sync-details"});let n=i.createDiv({cls:"publish-button-container"});this.closeButton=n.createEl("button",{text:"Cancel"}),this.closeButton.addEventListener("click",()=>{this.cancelled=!0,this.close()}),this.addStyles()}setStatus(i){this.statusEl&&(this.statusEl.empty(),this.statusEl.createEl("p",{text:i}))}setProgress(i){if(this.progressEl){let n=this.progressEl.querySelector(".publish-progress-bar");n&&(n.style.width=`${i}%`)}}showSuccess(i,n){!this.statusEl||!this.detailsEl||(this.statusEl.empty(),this.statusEl.addClass("publish-status-success"),this.statusEl.createEl("p",{text:"Published successfully!"}),this.detailsEl.empty(),this.detailsEl.createEl("p",{text:`Uploaded: ${n.uploaded} | Deleted: ${n.deleted} | Unchanged: ${n.unchanged}`}),i&&this.detailsEl.createEl("a",{text:i,href:i,cls:"publish-site-link"}).addEventListener("click",t=>{t.preventDefault(),window.open(i,"_blank")}),this.closeButton&&(this.closeButton.textContent="Close"),this.setProgress(100))}showError(i){this.statusEl&&(this.statusEl.empty(),this.statusEl.addClass("publish-status-error"),this.statusEl.createEl("p",{text:"Publish failed"}),this.statusEl.createEl("p",{text:i,cls:"publish-error-message"}),this.closeButton&&(this.closeButton.textContent="Close"))}isCancelled(){return this.cancelled}onClose(){let{contentEl:i}=this;i.empty()}addStyles(){let i=document.createElement("style");i.textContent=`
			.publish-sync-modal {
				padding: 20px;
				min-width: 300px;
			}
			.publish-sync-modal h2 {
				margin-bottom: 20px;
				text-align: center;
			}
			.publish-progress {
				height: 8px;
				background: var(--background-secondary);
				border-radius: 4px;
				overflow: hidden;
				margin-bottom: 20px;
			}
			.publish-progress-bar {
				height: 100%;
				width: 0%;
				background: var(--interactive-accent);
				transition: width 0.3s ease;
			}
			.publish-sync-status {
				text-align: center;
				margin-bottom: 16px;
			}
			.publish-sync-status p {
				margin: 4px 0;
			}
			.publish-status-success {
				color: var(--text-success);
			}
			.publish-status-error {
				color: var(--text-error);
			}
			.publish-error-message {
				font-size: 0.9em;
				color: var(--text-muted);
			}
			.publish-sync-details {
				text-align: center;
				font-size: 0.9em;
				color: var(--text-muted);
				margin-bottom: 16px;
			}
			.publish-site-link {
				display: block;
				margin-top: 8px;
				color: var(--text-accent);
			}
			.publish-button-container {
				display: flex;
				justify-content: center;
			}
			.publish-button-container button {
				padding: 8px 20px;
			}
		`,this.contentEl.appendChild(i)}};var Sn="https://api.pubit.site",Tn="https://auth.pubit.site",ve=Sn,Fn=Tn,Ke=`${Fn}/dashboard/`,ze="pubit.site",G={publishTag:"publish"};var P=require("obsidian");var ne=class extends P.PluginSettingTab{plugin;constructor(i,n){super(i,n),this.plugin=n}display(){let{containerEl:i}=this;i.empty();let n=!!this.plugin.settings.apiToken;if(new P.Setting(i).setName("Connection status").setDesc(n?`Connected as ${this.plugin.settings.userEmail||"Unknown"}`:"Not connected").addButton(r=>{n?r.setButtonText("Disconnect").setWarning().onClick(async()=>{await this.plugin.disconnect(),this.display()}):r.setButtonText("Connect").setCta().onClick(async()=>{await this.plugin.startDeviceCodeFlow(),setTimeout(()=>this.display(),1e3)})}),n&&this.plugin.settings.subdomain){let t=`https://${this.plugin.settings.subdomain}.${ze}`;new P.Setting(i).setName("Your site").setDesc(t).addButton(s=>s.setButtonText("Open Site").onClick(()=>{window.open(t,"_blank")})),new P.Setting(i).setName("Dashboard").setDesc("Manage your site, edit menu order, or delete your site").addButton(s=>s.setButtonText("Open Dashboard").onClick(()=>{window.open(Ke,"_blank")}))}new P.Setting(i).setName("Publish tag").setDesc('Notes with this property set to true in frontmatter will be published (e.g., "publish: true")').addText(r=>r.setPlaceholder("publish").setValue(this.plugin.settings.publishTag||"").onChange(async t=>{this.plugin.settings.publishTag=t||G.publishTag,await this.plugin.saveSettings()}))}};function Nn(e,i="publish"){if(!e.startsWith("---"))return!1;let n=e.indexOf(`
---`,3);if(n===-1)return!1;let r=e.slice(4,n),t=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return new RegExp(`^${t}:\\s*["']?true["']?\\s*$`,"im").test(r)}async function Qe(e,i="publish"){let n=e.vault.getMarkdownFiles(),r=[];for(let t of n){if(t.path.startsWith(".trash/")||t.path.startsWith(".obsidian/"))continue;let s=await e.vault.cachedRead(t);Nn(s,i)&&r.push(t)}return r}function Xe(e){return e.basename}function U(e){return e.path.replace(/\.md$/,"").split("/").map(t=>me(t)).join("/")}function Ze(e){let i=/!\[\[([^\]|]+)(?:\|[^\]]+)?\]\]/g,n=[],r;for(;(r=i.exec(e))!==null;){let t=r[1].trim();/\.(png|jpg|jpeg|gif|webp|svg)$/i.test(t)&&n.push(t)}return[...new Set(n)]}function Je(e,i){let n=e.vault.getFiles(),r=i.toLowerCase(),t=i.split("/").pop()||i,s=t.toLowerCase();for(let o of n)if(o.name===i||o.name===t||o.path===i)return o;for(let o of n)if(o.name.toLowerCase()===r||o.name.toLowerCase()===s)return o;for(let o of n)if(o.path.toLowerCase().endsWith(`/${s}`))return o;if(!/\.(png|jpg|jpeg|gif|webp|svg)$/i.test(i))for(let o of["png","jpg","jpeg","gif","webp","svg"]){let a=`${t}.${o}`.toLowerCase();for(let u of n)if(u.name.toLowerCase()===a)return u}return null}function mi(e){return typeof e>"u"||e===null}function In(e){return typeof e=="object"&&e!==null}function _n(e){return Array.isArray(e)?e:mi(e)?[]:[e]}function kn(e,i){var n,r,t,s;if(i)for(s=Object.keys(i),n=0,r=s.length;n<r;n+=1)t=s[n],e[t]=i[t];return e}function Rn(e,i){var n="",r;for(r=0;r<i;r+=1)n+=e;return n}function On(e){return e===0&&Number.NEGATIVE_INFINITY===1/e}var Bn=mi,Dn=In,Pn=_n,Ln=Rn,Mn=On,Un=kn,C={isNothing:Bn,isObject:Dn,toArray:Pn,repeat:Ln,isNegativeZero:Mn,extend:Un};function gi(e,i){var n="",r=e.reason||"(unknown reason)";return e.mark?(e.mark.name&&(n+='in "'+e.mark.name+'" '),n+="("+(e.mark.line+1)+":"+(e.mark.column+1)+")",!i&&e.mark.snippet&&(n+=`

`+e.mark.snippet),r+" "+n):r}function K(e,i){Error.call(this),this.name="YAMLException",this.reason=e,this.mark=i,this.message=gi(this,!1),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack||""}K.prototype=Object.create(Error.prototype);K.prototype.constructor=K;K.prototype.toString=function(i){return this.name+": "+gi(this,i)};var A=K;function ye(e,i,n,r,t){var s="",o="",l=Math.floor(t/2)-1;return r-i>l&&(s=" ... ",i=r-l+s.length),n-r>l&&(o=" ...",n=r+l-o.length),{str:s+e.slice(i,n).replace(/\t/g,"\u2192")+o,pos:r-i+s.length}}function Ce(e,i){return C.repeat(" ",i-e.length)+e}function $n(e,i){if(i=Object.create(i||null),!e.buffer)return null;i.maxLength||(i.maxLength=79),typeof i.indent!="number"&&(i.indent=1),typeof i.linesBefore!="number"&&(i.linesBefore=3),typeof i.linesAfter!="number"&&(i.linesAfter=2);for(var n=/\r?\n|\r|\0/g,r=[0],t=[],s,o=-1;s=n.exec(e.buffer);)t.push(s.index),r.push(s.index+s[0].length),e.position<=s.index&&o<0&&(o=r.length-2);o<0&&(o=r.length-1);var l="",a,u,p=Math.min(e.line+i.linesAfter,t.length).toString().length,c=i.maxLength-(i.indent+p+3);for(a=1;a<=i.linesBefore&&!(o-a<0);a++)u=ye(e.buffer,r[o-a],t[o-a],e.position-(r[o]-r[o-a]),c),l=C.repeat(" ",i.indent)+Ce((e.line-a+1).toString(),p)+" | "+u.str+`
`+l;for(u=ye(e.buffer,r[o],t[o],e.position,c),l+=C.repeat(" ",i.indent)+Ce((e.line+1).toString(),p)+" | "+u.str+`
`,l+=C.repeat("-",i.indent+p+3+u.pos)+`^
`,a=1;a<=i.linesAfter&&!(o+a>=t.length);a++)u=ye(e.buffer,r[o+a],t[o+a],e.position-(r[o]-r[o+a]),c),l+=C.repeat(" ",i.indent)+Ce((e.line+a+1).toString(),p)+" | "+u.str+`
`;return l.replace(/\n$/,"")}var jn=$n,Hn=["kind","multi","resolve","construct","instanceOf","predicate","represent","representName","defaultStyle","styleAliases"],Vn=["scalar","sequence","mapping"];function Yn(e){var i={};return e!==null&&Object.keys(e).forEach(function(n){e[n].forEach(function(r){i[String(r)]=n})}),i}function qn(e,i){if(i=i||{},Object.keys(i).forEach(function(n){if(Hn.indexOf(n)===-1)throw new A('Unknown option "'+n+'" is met in definition of "'+e+'" YAML type.')}),this.options=i,this.tag=e,this.kind=i.kind||null,this.resolve=i.resolve||function(){return!0},this.construct=i.construct||function(n){return n},this.instanceOf=i.instanceOf||null,this.predicate=i.predicate||null,this.represent=i.represent||null,this.representName=i.representName||null,this.defaultStyle=i.defaultStyle||null,this.multi=i.multi||!1,this.styleAliases=Yn(i.styleAliases||null),Vn.indexOf(this.kind)===-1)throw new A('Unknown kind "'+this.kind+'" is specified for "'+e+'" YAML type.')}var w=qn;function ei(e,i){var n=[];return e[i].forEach(function(r){var t=n.length;n.forEach(function(s,o){s.tag===r.tag&&s.kind===r.kind&&s.multi===r.multi&&(t=o)}),n[t]=r}),n}function Gn(){var e={scalar:{},sequence:{},mapping:{},fallback:{},multi:{scalar:[],sequence:[],mapping:[],fallback:[]}},i,n;function r(t){t.multi?(e.multi[t.kind].push(t),e.multi.fallback.push(t)):e[t.kind][t.tag]=e.fallback[t.tag]=t}for(i=0,n=arguments.length;i<n;i+=1)arguments[i].forEach(r);return e}function Ee(e){return this.extend(e)}Ee.prototype.extend=function(i){var n=[],r=[];if(i instanceof w)r.push(i);else if(Array.isArray(i))r=r.concat(i);else if(i&&(Array.isArray(i.implicit)||Array.isArray(i.explicit)))i.implicit&&(n=n.concat(i.implicit)),i.explicit&&(r=r.concat(i.explicit));else throw new A("Schema.extend argument should be a Type, [ Type ], or a schema definition ({ implicit: [...], explicit: [...] })");n.forEach(function(s){if(!(s instanceof w))throw new A("Specified list of YAML types (or a single Type object) contains a non-Type object.");if(s.loadKind&&s.loadKind!=="scalar")throw new A("There is a non-scalar type in the implicit list of a schema. Implicit resolving of such types is not supported.");if(s.multi)throw new A("There is a multi type in the implicit list of a schema. Multi tags can only be listed as explicit.")}),r.forEach(function(s){if(!(s instanceof w))throw new A("Specified list of YAML types (or a single Type object) contains a non-Type object.")});var t=Object.create(Ee.prototype);return t.implicit=(this.implicit||[]).concat(n),t.explicit=(this.explicit||[]).concat(r),t.compiledImplicit=ei(t,"implicit"),t.compiledExplicit=ei(t,"explicit"),t.compiledTypeMap=Gn(t.compiledImplicit,t.compiledExplicit),t};var xi=Ee,bi=new w("tag:yaml.org,2002:str",{kind:"scalar",construct:function(e){return e!==null?e:""}}),vi=new w("tag:yaml.org,2002:seq",{kind:"sequence",construct:function(e){return e!==null?e:[]}}),yi=new w("tag:yaml.org,2002:map",{kind:"mapping",construct:function(e){return e!==null?e:{}}}),Ci=new xi({explicit:[bi,vi,yi]});function Wn(e){if(e===null)return!0;var i=e.length;return i===1&&e==="~"||i===4&&(e==="null"||e==="Null"||e==="NULL")}function Kn(){return null}function zn(e){return e===null}var wi=new w("tag:yaml.org,2002:null",{kind:"scalar",resolve:Wn,construct:Kn,predicate:zn,represent:{canonical:function(){return"~"},lowercase:function(){return"null"},uppercase:function(){return"NULL"},camelcase:function(){return"Null"},empty:function(){return""}},defaultStyle:"lowercase"});function Qn(e){if(e===null)return!1;var i=e.length;return i===4&&(e==="true"||e==="True"||e==="TRUE")||i===5&&(e==="false"||e==="False"||e==="FALSE")}function Xn(e){return e==="true"||e==="True"||e==="TRUE"}function Zn(e){return Object.prototype.toString.call(e)==="[object Boolean]"}var Ei=new w("tag:yaml.org,2002:bool",{kind:"scalar",resolve:Qn,construct:Xn,predicate:Zn,represent:{lowercase:function(e){return e?"true":"false"},uppercase:function(e){return e?"TRUE":"FALSE"},camelcase:function(e){return e?"True":"False"}},defaultStyle:"lowercase"});function Jn(e){return 48<=e&&e<=57||65<=e&&e<=70||97<=e&&e<=102}function et(e){return 48<=e&&e<=55}function it(e){return 48<=e&&e<=57}function nt(e){if(e===null)return!1;var i=e.length,n=0,r=!1,t;if(!i)return!1;if(t=e[n],(t==="-"||t==="+")&&(t=e[++n]),t==="0"){if(n+1===i)return!0;if(t=e[++n],t==="b"){for(n++;n<i;n++)if(t=e[n],t!=="_"){if(t!=="0"&&t!=="1")return!1;r=!0}return r&&t!=="_"}if(t==="x"){for(n++;n<i;n++)if(t=e[n],t!=="_"){if(!Jn(e.charCodeAt(n)))return!1;r=!0}return r&&t!=="_"}if(t==="o"){for(n++;n<i;n++)if(t=e[n],t!=="_"){if(!et(e.charCodeAt(n)))return!1;r=!0}return r&&t!=="_"}}if(t==="_")return!1;for(;n<i;n++)if(t=e[n],t!=="_"){if(!it(e.charCodeAt(n)))return!1;r=!0}return!(!r||t==="_")}function tt(e){var i=e,n=1,r;if(i.indexOf("_")!==-1&&(i=i.replace(/_/g,"")),r=i[0],(r==="-"||r==="+")&&(r==="-"&&(n=-1),i=i.slice(1),r=i[0]),i==="0")return 0;if(r==="0"){if(i[1]==="b")return n*parseInt(i.slice(2),2);if(i[1]==="x")return n*parseInt(i.slice(2),16);if(i[1]==="o")return n*parseInt(i.slice(2),8)}return n*parseInt(i,10)}function rt(e){return Object.prototype.toString.call(e)==="[object Number]"&&e%1===0&&!C.isNegativeZero(e)}var Ai=new w("tag:yaml.org,2002:int",{kind:"scalar",resolve:nt,construct:tt,predicate:rt,represent:{binary:function(e){return e>=0?"0b"+e.toString(2):"-0b"+e.toString(2).slice(1)},octal:function(e){return e>=0?"0o"+e.toString(8):"-0o"+e.toString(8).slice(1)},decimal:function(e){return e.toString(10)},hexadecimal:function(e){return e>=0?"0x"+e.toString(16).toUpperCase():"-0x"+e.toString(16).toUpperCase().slice(1)}},defaultStyle:"decimal",styleAliases:{binary:[2,"bin"],octal:[8,"oct"],decimal:[10,"dec"],hexadecimal:[16,"hex"]}}),ot=new RegExp("^(?:[-+]?(?:[0-9][0-9_]*)(?:\\.[0-9_]*)?(?:[eE][-+]?[0-9]+)?|\\.[0-9_]+(?:[eE][-+]?[0-9]+)?|[-+]?\\.(?:inf|Inf|INF)|\\.(?:nan|NaN|NAN))$");function st(e){return!(e===null||!ot.test(e)||e[e.length-1]==="_")}function lt(e){var i,n;return i=e.replace(/_/g,"").toLowerCase(),n=i[0]==="-"?-1:1,"+-".indexOf(i[0])>=0&&(i=i.slice(1)),i===".inf"?n===1?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY:i===".nan"?NaN:n*parseFloat(i,10)}var at=/^[-+]?[0-9]+e/;function ut(e,i){var n;if(isNaN(e))switch(i){case"lowercase":return".nan";case"uppercase":return".NAN";case"camelcase":return".NaN"}else if(Number.POSITIVE_INFINITY===e)switch(i){case"lowercase":return".inf";case"uppercase":return".INF";case"camelcase":return".Inf"}else if(Number.NEGATIVE_INFINITY===e)switch(i){case"lowercase":return"-.inf";case"uppercase":return"-.INF";case"camelcase":return"-.Inf"}else if(C.isNegativeZero(e))return"-0.0";return n=e.toString(10),at.test(n)?n.replace("e",".e"):n}function ct(e){return Object.prototype.toString.call(e)==="[object Number]"&&(e%1!==0||C.isNegativeZero(e))}var Si=new w("tag:yaml.org,2002:float",{kind:"scalar",resolve:st,construct:lt,predicate:ct,represent:ut,defaultStyle:"lowercase"}),Ti=Ci.extend({implicit:[wi,Ei,Ai,Si]}),Fi=Ti,Ni=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9])-([0-9][0-9])$"),Ii=new RegExp("^([0-9][0-9][0-9][0-9])-([0-9][0-9]?)-([0-9][0-9]?)(?:[Tt]|[ \\t]+)([0-9][0-9]?):([0-9][0-9]):([0-9][0-9])(?:\\.([0-9]*))?(?:[ \\t]*(Z|([-+])([0-9][0-9]?)(?::([0-9][0-9]))?))?$");function pt(e){return e===null?!1:Ni.exec(e)!==null||Ii.exec(e)!==null}function ft(e){var i,n,r,t,s,o,l,a=0,u=null,p,c,f;if(i=Ni.exec(e),i===null&&(i=Ii.exec(e)),i===null)throw new Error("Date resolve error");if(n=+i[1],r=+i[2]-1,t=+i[3],!i[4])return new Date(Date.UTC(n,r,t));if(s=+i[4],o=+i[5],l=+i[6],i[7]){for(a=i[7].slice(0,3);a.length<3;)a+="0";a=+a}return i[9]&&(p=+i[10],c=+(i[11]||0),u=(p*60+c)*6e4,i[9]==="-"&&(u=-u)),f=new Date(Date.UTC(n,r,t,s,o,l,a)),u&&f.setTime(f.getTime()-u),f}function dt(e){return e.toISOString()}var _i=new w("tag:yaml.org,2002:timestamp",{kind:"scalar",resolve:pt,construct:ft,instanceOf:Date,represent:dt});function ht(e){return e==="<<"||e===null}var ki=new w("tag:yaml.org,2002:merge",{kind:"scalar",resolve:ht}),Ne=`ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=
\r`;function mt(e){if(e===null)return!1;var i,n,r=0,t=e.length,s=Ne;for(n=0;n<t;n++)if(i=s.indexOf(e.charAt(n)),!(i>64)){if(i<0)return!1;r+=6}return r%8===0}function gt(e){var i,n,r=e.replace(/[\r\n=]/g,""),t=r.length,s=Ne,o=0,l=[];for(i=0;i<t;i++)i%4===0&&i&&(l.push(o>>16&255),l.push(o>>8&255),l.push(o&255)),o=o<<6|s.indexOf(r.charAt(i));return n=t%4*6,n===0?(l.push(o>>16&255),l.push(o>>8&255),l.push(o&255)):n===18?(l.push(o>>10&255),l.push(o>>2&255)):n===12&&l.push(o>>4&255),new Uint8Array(l)}function xt(e){var i="",n=0,r,t,s=e.length,o=Ne;for(r=0;r<s;r++)r%3===0&&r&&(i+=o[n>>18&63],i+=o[n>>12&63],i+=o[n>>6&63],i+=o[n&63]),n=(n<<8)+e[r];return t=s%3,t===0?(i+=o[n>>18&63],i+=o[n>>12&63],i+=o[n>>6&63],i+=o[n&63]):t===2?(i+=o[n>>10&63],i+=o[n>>4&63],i+=o[n<<2&63],i+=o[64]):t===1&&(i+=o[n>>2&63],i+=o[n<<4&63],i+=o[64],i+=o[64]),i}function bt(e){return Object.prototype.toString.call(e)==="[object Uint8Array]"}var Ri=new w("tag:yaml.org,2002:binary",{kind:"scalar",resolve:mt,construct:gt,predicate:bt,represent:xt}),vt=Object.prototype.hasOwnProperty,yt=Object.prototype.toString;function Ct(e){if(e===null)return!0;var i=[],n,r,t,s,o,l=e;for(n=0,r=l.length;n<r;n+=1){if(t=l[n],o=!1,yt.call(t)!=="[object Object]")return!1;for(s in t)if(vt.call(t,s))if(!o)o=!0;else return!1;if(!o)return!1;if(i.indexOf(s)===-1)i.push(s);else return!1}return!0}function wt(e){return e!==null?e:[]}var Oi=new w("tag:yaml.org,2002:omap",{kind:"sequence",resolve:Ct,construct:wt}),Et=Object.prototype.toString;function At(e){if(e===null)return!0;var i,n,r,t,s,o=e;for(s=new Array(o.length),i=0,n=o.length;i<n;i+=1){if(r=o[i],Et.call(r)!=="[object Object]"||(t=Object.keys(r),t.length!==1))return!1;s[i]=[t[0],r[t[0]]]}return!0}function St(e){if(e===null)return[];var i,n,r,t,s,o=e;for(s=new Array(o.length),i=0,n=o.length;i<n;i+=1)r=o[i],t=Object.keys(r),s[i]=[t[0],r[t[0]]];return s}var Bi=new w("tag:yaml.org,2002:pairs",{kind:"sequence",resolve:At,construct:St}),Tt=Object.prototype.hasOwnProperty;function Ft(e){if(e===null)return!0;var i,n=e;for(i in n)if(Tt.call(n,i)&&n[i]!==null)return!1;return!0}function Nt(e){return e!==null?e:{}}var Di=new w("tag:yaml.org,2002:set",{kind:"mapping",resolve:Ft,construct:Nt}),Ie=Fi.extend({implicit:[_i,ki],explicit:[Ri,Oi,Bi,Di]}),D=Object.prototype.hasOwnProperty,te=1,Pi=2,Li=3,re=4,we=1,It=2,ii=3,_t=/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x84\x86-\x9F\uFFFE\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]/,kt=/[\x85\u2028\u2029]/,Rt=/[,\[\]\{\}]/,Mi=/^(?:!|!!|![a-z\-]+!)$/i,Ui=/^(?:!|[^,\[\]\{\}])(?:%[0-9a-f]{2}|[0-9a-z\-#;\/\?:@&=\+\$,_\.!~\*'\(\)\[\]])*$/i;function ni(e){return Object.prototype.toString.call(e)}function I(e){return e===10||e===13}function M(e){return e===9||e===32}function N(e){return e===9||e===32||e===10||e===13}function j(e){return e===44||e===91||e===93||e===123||e===125}function Ot(e){var i;return 48<=e&&e<=57?e-48:(i=e|32,97<=i&&i<=102?i-97+10:-1)}function Bt(e){return e===120?2:e===117?4:e===85?8:0}function Dt(e){return 48<=e&&e<=57?e-48:-1}function ti(e){return e===48?"\0":e===97?"\x07":e===98?"\b":e===116||e===9?"	":e===110?`
`:e===118?"\v":e===102?"\f":e===114?"\r":e===101?"\x1B":e===32?" ":e===34?'"':e===47?"/":e===92?"\\":e===78?"\x85":e===95?"\xA0":e===76?"\u2028":e===80?"\u2029":""}function Pt(e){return e<=65535?String.fromCharCode(e):String.fromCharCode((e-65536>>10)+55296,(e-65536&1023)+56320)}function $i(e,i,n){i==="__proto__"?Object.defineProperty(e,i,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[i]=n}var ji=new Array(256),Hi=new Array(256);for(L=0;L<256;L++)ji[L]=ti(L)?1:0,Hi[L]=ti(L);var L;function Lt(e,i){this.input=e,this.filename=i.filename||null,this.schema=i.schema||Ie,this.onWarning=i.onWarning||null,this.legacy=i.legacy||!1,this.json=i.json||!1,this.listener=i.listener||null,this.implicitTypes=this.schema.compiledImplicit,this.typeMap=this.schema.compiledTypeMap,this.length=e.length,this.position=0,this.line=0,this.lineStart=0,this.lineIndent=0,this.firstTabInLine=-1,this.documents=[]}function Vi(e,i){var n={name:e.filename,buffer:e.input.slice(0,-1),position:e.position,line:e.line,column:e.position-e.lineStart};return n.snippet=jn(n),new A(i,n)}function d(e,i){throw Vi(e,i)}function oe(e,i){e.onWarning&&e.onWarning.call(null,Vi(e,i))}var ri={YAML:function(i,n,r){var t,s,o;i.version!==null&&d(i,"duplication of %YAML directive"),r.length!==1&&d(i,"YAML directive accepts exactly one argument"),t=/^([0-9]+)\.([0-9]+)$/.exec(r[0]),t===null&&d(i,"ill-formed argument of the YAML directive"),s=parseInt(t[1],10),o=parseInt(t[2],10),s!==1&&d(i,"unacceptable YAML version of the document"),i.version=r[0],i.checkLineBreaks=o<2,o!==1&&o!==2&&oe(i,"unsupported YAML version of the document")},TAG:function(i,n,r){var t,s;r.length!==2&&d(i,"TAG directive accepts exactly two arguments"),t=r[0],s=r[1],Mi.test(t)||d(i,"ill-formed tag handle (first argument) of the TAG directive"),D.call(i.tagMap,t)&&d(i,'there is a previously declared suffix for "'+t+'" tag handle'),Ui.test(s)||d(i,"ill-formed tag prefix (second argument) of the TAG directive");try{s=decodeURIComponent(s)}catch{d(i,"tag prefix is malformed: "+s)}i.tagMap[t]=s}};function B(e,i,n,r){var t,s,o,l;if(i<n){if(l=e.input.slice(i,n),r)for(t=0,s=l.length;t<s;t+=1)o=l.charCodeAt(t),o===9||32<=o&&o<=1114111||d(e,"expected valid JSON character");else _t.test(l)&&d(e,"the stream contains non-printable characters");e.result+=l}}function oi(e,i,n,r){var t,s,o,l;for(C.isObject(n)||d(e,"cannot merge mappings; the provided source object is unacceptable"),t=Object.keys(n),o=0,l=t.length;o<l;o+=1)s=t[o],D.call(i,s)||($i(i,s,n[s]),r[s]=!0)}function H(e,i,n,r,t,s,o,l,a){var u,p;if(Array.isArray(t))for(t=Array.prototype.slice.call(t),u=0,p=t.length;u<p;u+=1)Array.isArray(t[u])&&d(e,"nested arrays are not supported inside keys"),typeof t=="object"&&ni(t[u])==="[object Object]"&&(t[u]="[object Object]");if(typeof t=="object"&&ni(t)==="[object Object]"&&(t="[object Object]"),t=String(t),i===null&&(i={}),r==="tag:yaml.org,2002:merge")if(Array.isArray(s))for(u=0,p=s.length;u<p;u+=1)oi(e,i,s[u],n);else oi(e,i,s,n);else!e.json&&!D.call(n,t)&&D.call(i,t)&&(e.line=o||e.line,e.lineStart=l||e.lineStart,e.position=a||e.position,d(e,"duplicated mapping key")),$i(i,t,s),delete n[t];return i}function _e(e){var i;i=e.input.charCodeAt(e.position),i===10?e.position++:i===13?(e.position++,e.input.charCodeAt(e.position)===10&&e.position++):d(e,"a line break is expected"),e.line+=1,e.lineStart=e.position,e.firstTabInLine=-1}function y(e,i,n){for(var r=0,t=e.input.charCodeAt(e.position);t!==0;){for(;M(t);)t===9&&e.firstTabInLine===-1&&(e.firstTabInLine=e.position),t=e.input.charCodeAt(++e.position);if(i&&t===35)do t=e.input.charCodeAt(++e.position);while(t!==10&&t!==13&&t!==0);if(I(t))for(_e(e),t=e.input.charCodeAt(e.position),r++,e.lineIndent=0;t===32;)e.lineIndent++,t=e.input.charCodeAt(++e.position);else break}return n!==-1&&r!==0&&e.lineIndent<n&&oe(e,"deficient indentation"),r}function ae(e){var i=e.position,n;return n=e.input.charCodeAt(i),!!((n===45||n===46)&&n===e.input.charCodeAt(i+1)&&n===e.input.charCodeAt(i+2)&&(i+=3,n=e.input.charCodeAt(i),n===0||N(n)))}function ke(e,i){i===1?e.result+=" ":i>1&&(e.result+=C.repeat(`
`,i-1))}function Mt(e,i,n){var r,t,s,o,l,a,u,p,c=e.kind,f=e.result,h;if(h=e.input.charCodeAt(e.position),N(h)||j(h)||h===35||h===38||h===42||h===33||h===124||h===62||h===39||h===34||h===37||h===64||h===96||(h===63||h===45)&&(t=e.input.charCodeAt(e.position+1),N(t)||n&&j(t)))return!1;for(e.kind="scalar",e.result="",s=o=e.position,l=!1;h!==0;){if(h===58){if(t=e.input.charCodeAt(e.position+1),N(t)||n&&j(t))break}else if(h===35){if(r=e.input.charCodeAt(e.position-1),N(r))break}else{if(e.position===e.lineStart&&ae(e)||n&&j(h))break;if(I(h))if(a=e.line,u=e.lineStart,p=e.lineIndent,y(e,!1,-1),e.lineIndent>=i){l=!0,h=e.input.charCodeAt(e.position);continue}else{e.position=o,e.line=a,e.lineStart=u,e.lineIndent=p;break}}l&&(B(e,s,o,!1),ke(e,e.line-a),s=o=e.position,l=!1),M(h)||(o=e.position+1),h=e.input.charCodeAt(++e.position)}return B(e,s,o,!1),e.result?!0:(e.kind=c,e.result=f,!1)}function Ut(e,i){var n,r,t;if(n=e.input.charCodeAt(e.position),n!==39)return!1;for(e.kind="scalar",e.result="",e.position++,r=t=e.position;(n=e.input.charCodeAt(e.position))!==0;)if(n===39)if(B(e,r,e.position,!0),n=e.input.charCodeAt(++e.position),n===39)r=e.position,e.position++,t=e.position;else return!0;else I(n)?(B(e,r,t,!0),ke(e,y(e,!1,i)),r=t=e.position):e.position===e.lineStart&&ae(e)?d(e,"unexpected end of the document within a single quoted scalar"):(e.position++,t=e.position);d(e,"unexpected end of the stream within a single quoted scalar")}function $t(e,i){var n,r,t,s,o,l;if(l=e.input.charCodeAt(e.position),l!==34)return!1;for(e.kind="scalar",e.result="",e.position++,n=r=e.position;(l=e.input.charCodeAt(e.position))!==0;){if(l===34)return B(e,n,e.position,!0),e.position++,!0;if(l===92){if(B(e,n,e.position,!0),l=e.input.charCodeAt(++e.position),I(l))y(e,!1,i);else if(l<256&&ji[l])e.result+=Hi[l],e.position++;else if((o=Bt(l))>0){for(t=o,s=0;t>0;t--)l=e.input.charCodeAt(++e.position),(o=Ot(l))>=0?s=(s<<4)+o:d(e,"expected hexadecimal character");e.result+=Pt(s),e.position++}else d(e,"unknown escape sequence");n=r=e.position}else I(l)?(B(e,n,r,!0),ke(e,y(e,!1,i)),n=r=e.position):e.position===e.lineStart&&ae(e)?d(e,"unexpected end of the document within a double quoted scalar"):(e.position++,r=e.position)}d(e,"unexpected end of the stream within a double quoted scalar")}function jt(e,i){var n=!0,r,t,s,o=e.tag,l,a=e.anchor,u,p,c,f,h,m=Object.create(null),x,b,S,g;if(g=e.input.charCodeAt(e.position),g===91)p=93,h=!1,l=[];else if(g===123)p=125,h=!0,l={};else return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=l),g=e.input.charCodeAt(++e.position);g!==0;){if(y(e,!0,i),g=e.input.charCodeAt(e.position),g===p)return e.position++,e.tag=o,e.anchor=a,e.kind=h?"mapping":"sequence",e.result=l,!0;n?g===44&&d(e,"expected the node content, but found ','"):d(e,"missed comma between flow collection entries"),b=x=S=null,c=f=!1,g===63&&(u=e.input.charCodeAt(e.position+1),N(u)&&(c=f=!0,e.position++,y(e,!0,i))),r=e.line,t=e.lineStart,s=e.position,V(e,i,te,!1,!0),b=e.tag,x=e.result,y(e,!0,i),g=e.input.charCodeAt(e.position),(f||e.line===r)&&g===58&&(c=!0,g=e.input.charCodeAt(++e.position),y(e,!0,i),V(e,i,te,!1,!0),S=e.result),h?H(e,l,m,b,x,S,r,t,s):c?l.push(H(e,null,m,b,x,S,r,t,s)):l.push(x),y(e,!0,i),g=e.input.charCodeAt(e.position),g===44?(n=!0,g=e.input.charCodeAt(++e.position)):n=!1}d(e,"unexpected end of the stream within a flow collection")}function Ht(e,i){var n,r,t=we,s=!1,o=!1,l=i,a=0,u=!1,p,c;if(c=e.input.charCodeAt(e.position),c===124)r=!1;else if(c===62)r=!0;else return!1;for(e.kind="scalar",e.result="";c!==0;)if(c=e.input.charCodeAt(++e.position),c===43||c===45)we===t?t=c===43?ii:It:d(e,"repeat of a chomping mode identifier");else if((p=Dt(c))>=0)p===0?d(e,"bad explicit indentation width of a block scalar; it cannot be less than one"):o?d(e,"repeat of an indentation width identifier"):(l=i+p-1,o=!0);else break;if(M(c)){do c=e.input.charCodeAt(++e.position);while(M(c));if(c===35)do c=e.input.charCodeAt(++e.position);while(!I(c)&&c!==0)}for(;c!==0;){for(_e(e),e.lineIndent=0,c=e.input.charCodeAt(e.position);(!o||e.lineIndent<l)&&c===32;)e.lineIndent++,c=e.input.charCodeAt(++e.position);if(!o&&e.lineIndent>l&&(l=e.lineIndent),I(c)){a++;continue}if(e.lineIndent<l){t===ii?e.result+=C.repeat(`
`,s?1+a:a):t===we&&s&&(e.result+=`
`);break}for(r?M(c)?(u=!0,e.result+=C.repeat(`
`,s?1+a:a)):u?(u=!1,e.result+=C.repeat(`
`,a+1)):a===0?s&&(e.result+=" "):e.result+=C.repeat(`
`,a):e.result+=C.repeat(`
`,s?1+a:a),s=!0,o=!0,a=0,n=e.position;!I(c)&&c!==0;)c=e.input.charCodeAt(++e.position);B(e,n,e.position,!1)}return!0}function si(e,i){var n,r=e.tag,t=e.anchor,s=[],o,l=!1,a;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=s),a=e.input.charCodeAt(e.position);a!==0&&(e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,d(e,"tab characters must not be used in indentation")),!(a!==45||(o=e.input.charCodeAt(e.position+1),!N(o))));){if(l=!0,e.position++,y(e,!0,-1)&&e.lineIndent<=i){s.push(null),a=e.input.charCodeAt(e.position);continue}if(n=e.line,V(e,i,Li,!1,!0),s.push(e.result),y(e,!0,-1),a=e.input.charCodeAt(e.position),(e.line===n||e.lineIndent>i)&&a!==0)d(e,"bad indentation of a sequence entry");else if(e.lineIndent<i)break}return l?(e.tag=r,e.anchor=t,e.kind="sequence",e.result=s,!0):!1}function Vt(e,i,n){var r,t,s,o,l,a,u=e.tag,p=e.anchor,c={},f=Object.create(null),h=null,m=null,x=null,b=!1,S=!1,g;if(e.firstTabInLine!==-1)return!1;for(e.anchor!==null&&(e.anchorMap[e.anchor]=c),g=e.input.charCodeAt(e.position);g!==0;){if(!b&&e.firstTabInLine!==-1&&(e.position=e.firstTabInLine,d(e,"tab characters must not be used in indentation")),r=e.input.charCodeAt(e.position+1),s=e.line,(g===63||g===58)&&N(r))g===63?(b&&(H(e,c,f,h,m,null,o,l,a),h=m=x=null),S=!0,b=!0,t=!0):b?(b=!1,t=!0):d(e,"incomplete explicit mapping pair; a key node is missed; or followed by a non-tabulated empty line"),e.position+=1,g=r;else{if(o=e.line,l=e.lineStart,a=e.position,!V(e,n,Pi,!1,!0))break;if(e.line===s){for(g=e.input.charCodeAt(e.position);M(g);)g=e.input.charCodeAt(++e.position);if(g===58)g=e.input.charCodeAt(++e.position),N(g)||d(e,"a whitespace character is expected after the key-value separator within a block mapping"),b&&(H(e,c,f,h,m,null,o,l,a),h=m=x=null),S=!0,b=!1,t=!1,h=e.tag,m=e.result;else if(S)d(e,"can not read an implicit mapping pair; a colon is missed");else return e.tag=u,e.anchor=p,!0}else if(S)d(e,"can not read a block mapping entry; a multiline key may not be an implicit key");else return e.tag=u,e.anchor=p,!0}if((e.line===s||e.lineIndent>i)&&(b&&(o=e.line,l=e.lineStart,a=e.position),V(e,i,re,!0,t)&&(b?m=e.result:x=e.result),b||(H(e,c,f,h,m,x,o,l,a),h=m=x=null),y(e,!0,-1),g=e.input.charCodeAt(e.position)),(e.line===s||e.lineIndent>i)&&g!==0)d(e,"bad indentation of a mapping entry");else if(e.lineIndent<i)break}return b&&H(e,c,f,h,m,null,o,l,a),S&&(e.tag=u,e.anchor=p,e.kind="mapping",e.result=c),S}function Yt(e){var i,n=!1,r=!1,t,s,o;if(o=e.input.charCodeAt(e.position),o!==33)return!1;if(e.tag!==null&&d(e,"duplication of a tag property"),o=e.input.charCodeAt(++e.position),o===60?(n=!0,o=e.input.charCodeAt(++e.position)):o===33?(r=!0,t="!!",o=e.input.charCodeAt(++e.position)):t="!",i=e.position,n){do o=e.input.charCodeAt(++e.position);while(o!==0&&o!==62);e.position<e.length?(s=e.input.slice(i,e.position),o=e.input.charCodeAt(++e.position)):d(e,"unexpected end of the stream within a verbatim tag")}else{for(;o!==0&&!N(o);)o===33&&(r?d(e,"tag suffix cannot contain exclamation marks"):(t=e.input.slice(i-1,e.position+1),Mi.test(t)||d(e,"named tag handle cannot contain such characters"),r=!0,i=e.position+1)),o=e.input.charCodeAt(++e.position);s=e.input.slice(i,e.position),Rt.test(s)&&d(e,"tag suffix cannot contain flow indicator characters")}s&&!Ui.test(s)&&d(e,"tag name cannot contain such characters: "+s);try{s=decodeURIComponent(s)}catch{d(e,"tag name is malformed: "+s)}return n?e.tag=s:D.call(e.tagMap,t)?e.tag=e.tagMap[t]+s:t==="!"?e.tag="!"+s:t==="!!"?e.tag="tag:yaml.org,2002:"+s:d(e,'undeclared tag handle "'+t+'"'),!0}function qt(e){var i,n;if(n=e.input.charCodeAt(e.position),n!==38)return!1;for(e.anchor!==null&&d(e,"duplication of an anchor property"),n=e.input.charCodeAt(++e.position),i=e.position;n!==0&&!N(n)&&!j(n);)n=e.input.charCodeAt(++e.position);return e.position===i&&d(e,"name of an anchor node must contain at least one character"),e.anchor=e.input.slice(i,e.position),!0}function Gt(e){var i,n,r;if(r=e.input.charCodeAt(e.position),r!==42)return!1;for(r=e.input.charCodeAt(++e.position),i=e.position;r!==0&&!N(r)&&!j(r);)r=e.input.charCodeAt(++e.position);return e.position===i&&d(e,"name of an alias node must contain at least one character"),n=e.input.slice(i,e.position),D.call(e.anchorMap,n)||d(e,'unidentified alias "'+n+'"'),e.result=e.anchorMap[n],y(e,!0,-1),!0}function V(e,i,n,r,t){var s,o,l,a=1,u=!1,p=!1,c,f,h,m,x,b;if(e.listener!==null&&e.listener("open",e),e.tag=null,e.anchor=null,e.kind=null,e.result=null,s=o=l=re===n||Li===n,r&&y(e,!0,-1)&&(u=!0,e.lineIndent>i?a=1:e.lineIndent===i?a=0:e.lineIndent<i&&(a=-1)),a===1)for(;Yt(e)||qt(e);)y(e,!0,-1)?(u=!0,l=s,e.lineIndent>i?a=1:e.lineIndent===i?a=0:e.lineIndent<i&&(a=-1)):l=!1;if(l&&(l=u||t),(a===1||re===n)&&(te===n||Pi===n?x=i:x=i+1,b=e.position-e.lineStart,a===1?l&&(si(e,b)||Vt(e,b,x))||jt(e,x)?p=!0:(o&&Ht(e,x)||Ut(e,x)||$t(e,x)?p=!0:Gt(e)?(p=!0,(e.tag!==null||e.anchor!==null)&&d(e,"alias node should not have any properties")):Mt(e,x,te===n)&&(p=!0,e.tag===null&&(e.tag="?")),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):a===0&&(p=l&&si(e,b))),e.tag===null)e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);else if(e.tag==="?"){for(e.result!==null&&e.kind!=="scalar"&&d(e,'unacceptable node kind for !<?> tag; it should be "scalar", not "'+e.kind+'"'),c=0,f=e.implicitTypes.length;c<f;c+=1)if(m=e.implicitTypes[c],m.resolve(e.result)){e.result=m.construct(e.result),e.tag=m.tag,e.anchor!==null&&(e.anchorMap[e.anchor]=e.result);break}}else if(e.tag!=="!"){if(D.call(e.typeMap[e.kind||"fallback"],e.tag))m=e.typeMap[e.kind||"fallback"][e.tag];else for(m=null,h=e.typeMap.multi[e.kind||"fallback"],c=0,f=h.length;c<f;c+=1)if(e.tag.slice(0,h[c].tag.length)===h[c].tag){m=h[c];break}m||d(e,"unknown tag !<"+e.tag+">"),e.result!==null&&m.kind!==e.kind&&d(e,"unacceptable node kind for !<"+e.tag+'> tag; it should be "'+m.kind+'", not "'+e.kind+'"'),m.resolve(e.result,e.tag)?(e.result=m.construct(e.result,e.tag),e.anchor!==null&&(e.anchorMap[e.anchor]=e.result)):d(e,"cannot resolve a node with !<"+e.tag+"> explicit tag")}return e.listener!==null&&e.listener("close",e),e.tag!==null||e.anchor!==null||p}function Wt(e){var i=e.position,n,r,t,s=!1,o;for(e.version=null,e.checkLineBreaks=e.legacy,e.tagMap=Object.create(null),e.anchorMap=Object.create(null);(o=e.input.charCodeAt(e.position))!==0&&(y(e,!0,-1),o=e.input.charCodeAt(e.position),!(e.lineIndent>0||o!==37));){for(s=!0,o=e.input.charCodeAt(++e.position),n=e.position;o!==0&&!N(o);)o=e.input.charCodeAt(++e.position);for(r=e.input.slice(n,e.position),t=[],r.length<1&&d(e,"directive name must not be less than one character in length");o!==0;){for(;M(o);)o=e.input.charCodeAt(++e.position);if(o===35){do o=e.input.charCodeAt(++e.position);while(o!==0&&!I(o));break}if(I(o))break;for(n=e.position;o!==0&&!N(o);)o=e.input.charCodeAt(++e.position);t.push(e.input.slice(n,e.position))}o!==0&&_e(e),D.call(ri,r)?ri[r](e,r,t):oe(e,'unknown document directive "'+r+'"')}if(y(e,!0,-1),e.lineIndent===0&&e.input.charCodeAt(e.position)===45&&e.input.charCodeAt(e.position+1)===45&&e.input.charCodeAt(e.position+2)===45?(e.position+=3,y(e,!0,-1)):s&&d(e,"directives end mark is expected"),V(e,e.lineIndent-1,re,!1,!0),y(e,!0,-1),e.checkLineBreaks&&kt.test(e.input.slice(i,e.position))&&oe(e,"non-ASCII line breaks are interpreted as content"),e.documents.push(e.result),e.position===e.lineStart&&ae(e)){e.input.charCodeAt(e.position)===46&&(e.position+=3,y(e,!0,-1));return}if(e.position<e.length-1)d(e,"end of the stream or a document separator is expected");else return}function Yi(e,i){e=String(e),i=i||{},e.length!==0&&(e.charCodeAt(e.length-1)!==10&&e.charCodeAt(e.length-1)!==13&&(e+=`
`),e.charCodeAt(0)===65279&&(e=e.slice(1)));var n=new Lt(e,i),r=e.indexOf("\0");for(r!==-1&&(n.position=r,d(n,"null byte is not allowed in input")),n.input+="\0";n.input.charCodeAt(n.position)===32;)n.lineIndent+=1,n.position+=1;for(;n.position<n.length-1;)Wt(n);return n.documents}function Kt(e,i,n){i!==null&&typeof i=="object"&&typeof n>"u"&&(n=i,i=null);var r=Yi(e,n);if(typeof i!="function")return r;for(var t=0,s=r.length;t<s;t+=1)i(r[t])}function zt(e,i){var n=Yi(e,i);if(n.length!==0){if(n.length===1)return n[0];throw new A("expected a single document in the stream, but found more")}}var Qt=Kt,Xt=zt,qi={loadAll:Qt,load:Xt},Gi=Object.prototype.toString,Wi=Object.prototype.hasOwnProperty,Re=65279,Zt=9,z=10,Jt=13,er=32,ir=33,nr=34,Ae=35,tr=37,rr=38,or=39,sr=42,Ki=44,lr=45,se=58,ar=61,ur=62,cr=63,pr=64,zi=91,Qi=93,fr=96,Xi=123,dr=124,Zi=125,E={};E[0]="\\0";E[7]="\\a";E[8]="\\b";E[9]="\\t";E[10]="\\n";E[11]="\\v";E[12]="\\f";E[13]="\\r";E[27]="\\e";E[34]='\\"';E[92]="\\\\";E[133]="\\N";E[160]="\\_";E[8232]="\\L";E[8233]="\\P";var hr=["y","Y","yes","Yes","YES","on","On","ON","n","N","no","No","NO","off","Off","OFF"],mr=/^[-+]?[0-9_]+(?::[0-9_]+)+(?:\.[0-9_]*)?$/;function gr(e,i){var n,r,t,s,o,l,a;if(i===null)return{};for(n={},r=Object.keys(i),t=0,s=r.length;t<s;t+=1)o=r[t],l=String(i[o]),o.slice(0,2)==="!!"&&(o="tag:yaml.org,2002:"+o.slice(2)),a=e.compiledTypeMap.fallback[o],a&&Wi.call(a.styleAliases,l)&&(l=a.styleAliases[l]),n[o]=l;return n}function xr(e){var i,n,r;if(i=e.toString(16).toUpperCase(),e<=255)n="x",r=2;else if(e<=65535)n="u",r=4;else if(e<=4294967295)n="U",r=8;else throw new A("code point within a string may not be greater than 0xFFFFFFFF");return"\\"+n+C.repeat("0",r-i.length)+i}var br=1,Q=2;function vr(e){this.schema=e.schema||Ie,this.indent=Math.max(1,e.indent||2),this.noArrayIndent=e.noArrayIndent||!1,this.skipInvalid=e.skipInvalid||!1,this.flowLevel=C.isNothing(e.flowLevel)?-1:e.flowLevel,this.styleMap=gr(this.schema,e.styles||null),this.sortKeys=e.sortKeys||!1,this.lineWidth=e.lineWidth||80,this.noRefs=e.noRefs||!1,this.noCompatMode=e.noCompatMode||!1,this.condenseFlow=e.condenseFlow||!1,this.quotingType=e.quotingType==='"'?Q:br,this.forceQuotes=e.forceQuotes||!1,this.replacer=typeof e.replacer=="function"?e.replacer:null,this.implicitTypes=this.schema.compiledImplicit,this.explicitTypes=this.schema.compiledExplicit,this.tag=null,this.result="",this.duplicates=[],this.usedDuplicates=null}function li(e,i){for(var n=C.repeat(" ",i),r=0,t=-1,s="",o,l=e.length;r<l;)t=e.indexOf(`
`,r),t===-1?(o=e.slice(r),r=l):(o=e.slice(r,t+1),r=t+1),o.length&&o!==`
`&&(s+=n),s+=o;return s}function Se(e,i){return`
`+C.repeat(" ",e.indent*i)}function yr(e,i){var n,r,t;for(n=0,r=e.implicitTypes.length;n<r;n+=1)if(t=e.implicitTypes[n],t.resolve(i))return!0;return!1}function le(e){return e===er||e===Zt}function X(e){return 32<=e&&e<=126||161<=e&&e<=55295&&e!==8232&&e!==8233||57344<=e&&e<=65533&&e!==Re||65536<=e&&e<=1114111}function ai(e){return X(e)&&e!==Re&&e!==Jt&&e!==z}function ui(e,i,n){var r=ai(e),t=r&&!le(e);return(n?r:r&&e!==Ki&&e!==zi&&e!==Qi&&e!==Xi&&e!==Zi)&&e!==Ae&&!(i===se&&!t)||ai(i)&&!le(i)&&e===Ae||i===se&&t}function Cr(e){return X(e)&&e!==Re&&!le(e)&&e!==lr&&e!==cr&&e!==se&&e!==Ki&&e!==zi&&e!==Qi&&e!==Xi&&e!==Zi&&e!==Ae&&e!==rr&&e!==sr&&e!==ir&&e!==dr&&e!==ar&&e!==ur&&e!==or&&e!==nr&&e!==tr&&e!==pr&&e!==fr}function wr(e){return!le(e)&&e!==se}function W(e,i){var n=e.charCodeAt(i),r;return n>=55296&&n<=56319&&i+1<e.length&&(r=e.charCodeAt(i+1),r>=56320&&r<=57343)?(n-55296)*1024+r-56320+65536:n}function Ji(e){var i=/^\n* /;return i.test(e)}var en=1,Te=2,nn=3,tn=4,$=5;function Er(e,i,n,r,t,s,o,l){var a,u=0,p=null,c=!1,f=!1,h=r!==-1,m=-1,x=Cr(W(e,0))&&wr(W(e,e.length-1));if(i||o)for(a=0;a<e.length;u>=65536?a+=2:a++){if(u=W(e,a),!X(u))return $;x=x&&ui(u,p,l),p=u}else{for(a=0;a<e.length;u>=65536?a+=2:a++){if(u=W(e,a),u===z)c=!0,h&&(f=f||a-m-1>r&&e[m+1]!==" ",m=a);else if(!X(u))return $;x=x&&ui(u,p,l),p=u}f=f||h&&a-m-1>r&&e[m+1]!==" "}return!c&&!f?x&&!o&&!t(e)?en:s===Q?$:Te:n>9&&Ji(e)?$:o?s===Q?$:Te:f?tn:nn}function Ar(e,i,n,r,t){e.dump=function(){if(i.length===0)return e.quotingType===Q?'""':"''";if(!e.noCompatMode&&(hr.indexOf(i)!==-1||mr.test(i)))return e.quotingType===Q?'"'+i+'"':"'"+i+"'";var s=e.indent*Math.max(1,n),o=e.lineWidth===-1?-1:Math.max(Math.min(e.lineWidth,40),e.lineWidth-s),l=r||e.flowLevel>-1&&n>=e.flowLevel;function a(u){return yr(e,u)}switch(Er(i,l,e.indent,o,a,e.quotingType,e.forceQuotes&&!r,t)){case en:return i;case Te:return"'"+i.replace(/'/g,"''")+"'";case nn:return"|"+ci(i,e.indent)+pi(li(i,s));case tn:return">"+ci(i,e.indent)+pi(li(Sr(i,o),s));case $:return'"'+Tr(i)+'"';default:throw new A("impossible error: invalid scalar style")}}()}function ci(e,i){var n=Ji(e)?String(i):"",r=e[e.length-1]===`
`,t=r&&(e[e.length-2]===`
`||e===`
`),s=t?"+":r?"":"-";return n+s+`
`}function pi(e){return e[e.length-1]===`
`?e.slice(0,-1):e}function Sr(e,i){for(var n=/(\n+)([^\n]*)/g,r=function(){var u=e.indexOf(`
`);return u=u!==-1?u:e.length,n.lastIndex=u,fi(e.slice(0,u),i)}(),t=e[0]===`
`||e[0]===" ",s,o;o=n.exec(e);){var l=o[1],a=o[2];s=a[0]===" ",r+=l+(!t&&!s&&a!==""?`
`:"")+fi(a,i),t=s}return r}function fi(e,i){if(e===""||e[0]===" ")return e;for(var n=/ [^ ]/g,r,t=0,s,o=0,l=0,a="";r=n.exec(e);)l=r.index,l-t>i&&(s=o>t?o:l,a+=`
`+e.slice(t,s),t=s+1),o=l;return a+=`
`,e.length-t>i&&o>t?a+=e.slice(t,o)+`
`+e.slice(o+1):a+=e.slice(t),a.slice(1)}function Tr(e){for(var i="",n=0,r,t=0;t<e.length;n>=65536?t+=2:t++)n=W(e,t),r=E[n],!r&&X(n)?(i+=e[t],n>=65536&&(i+=e[t+1])):i+=r||xr(n);return i}function Fr(e,i,n){var r="",t=e.tag,s,o,l;for(s=0,o=n.length;s<o;s+=1)l=n[s],e.replacer&&(l=e.replacer.call(n,String(s),l)),(_(e,i,l,!1,!1)||typeof l>"u"&&_(e,i,null,!1,!1))&&(r!==""&&(r+=","+(e.condenseFlow?"":" ")),r+=e.dump);e.tag=t,e.dump="["+r+"]"}function di(e,i,n,r){var t="",s=e.tag,o,l,a;for(o=0,l=n.length;o<l;o+=1)a=n[o],e.replacer&&(a=e.replacer.call(n,String(o),a)),(_(e,i+1,a,!0,!0,!1,!0)||typeof a>"u"&&_(e,i+1,null,!0,!0,!1,!0))&&((!r||t!=="")&&(t+=Se(e,i)),e.dump&&z===e.dump.charCodeAt(0)?t+="-":t+="- ",t+=e.dump);e.tag=s,e.dump=t||"[]"}function Nr(e,i,n){var r="",t=e.tag,s=Object.keys(n),o,l,a,u,p;for(o=0,l=s.length;o<l;o+=1)p="",r!==""&&(p+=", "),e.condenseFlow&&(p+='"'),a=s[o],u=n[a],e.replacer&&(u=e.replacer.call(n,a,u)),_(e,i,a,!1,!1)&&(e.dump.length>1024&&(p+="? "),p+=e.dump+(e.condenseFlow?'"':"")+":"+(e.condenseFlow?"":" "),_(e,i,u,!1,!1)&&(p+=e.dump,r+=p));e.tag=t,e.dump="{"+r+"}"}function Ir(e,i,n,r){var t="",s=e.tag,o=Object.keys(n),l,a,u,p,c,f;if(e.sortKeys===!0)o.sort();else if(typeof e.sortKeys=="function")o.sort(e.sortKeys);else if(e.sortKeys)throw new A("sortKeys must be a boolean or a function");for(l=0,a=o.length;l<a;l+=1)f="",(!r||t!=="")&&(f+=Se(e,i)),u=o[l],p=n[u],e.replacer&&(p=e.replacer.call(n,u,p)),_(e,i+1,u,!0,!0,!0)&&(c=e.tag!==null&&e.tag!=="?"||e.dump&&e.dump.length>1024,c&&(e.dump&&z===e.dump.charCodeAt(0)?f+="?":f+="? "),f+=e.dump,c&&(f+=Se(e,i)),_(e,i+1,p,!0,c)&&(e.dump&&z===e.dump.charCodeAt(0)?f+=":":f+=": ",f+=e.dump,t+=f));e.tag=s,e.dump=t||"{}"}function hi(e,i,n){var r,t,s,o,l,a;for(t=n?e.explicitTypes:e.implicitTypes,s=0,o=t.length;s<o;s+=1)if(l=t[s],(l.instanceOf||l.predicate)&&(!l.instanceOf||typeof i=="object"&&i instanceof l.instanceOf)&&(!l.predicate||l.predicate(i))){if(n?l.multi&&l.representName?e.tag=l.representName(i):e.tag=l.tag:e.tag="?",l.represent){if(a=e.styleMap[l.tag]||l.defaultStyle,Gi.call(l.represent)==="[object Function]")r=l.represent(i,a);else if(Wi.call(l.represent,a))r=l.represent[a](i,a);else throw new A("!<"+l.tag+'> tag resolver accepts not "'+a+'" style');e.dump=r}return!0}return!1}function _(e,i,n,r,t,s,o){e.tag=null,e.dump=n,hi(e,n,!1)||hi(e,n,!0);var l=Gi.call(e.dump),a=r,u;r&&(r=e.flowLevel<0||e.flowLevel>i);var p=l==="[object Object]"||l==="[object Array]",c,f;if(p&&(c=e.duplicates.indexOf(n),f=c!==-1),(e.tag!==null&&e.tag!=="?"||f||e.indent!==2&&i>0)&&(t=!1),f&&e.usedDuplicates[c])e.dump="*ref_"+c;else{if(p&&f&&!e.usedDuplicates[c]&&(e.usedDuplicates[c]=!0),l==="[object Object]")r&&Object.keys(e.dump).length!==0?(Ir(e,i,e.dump,t),f&&(e.dump="&ref_"+c+e.dump)):(Nr(e,i,e.dump),f&&(e.dump="&ref_"+c+" "+e.dump));else if(l==="[object Array]")r&&e.dump.length!==0?(e.noArrayIndent&&!o&&i>0?di(e,i-1,e.dump,t):di(e,i,e.dump,t),f&&(e.dump="&ref_"+c+e.dump)):(Fr(e,i,e.dump),f&&(e.dump="&ref_"+c+" "+e.dump));else if(l==="[object String]")e.tag!=="?"&&Ar(e,e.dump,i,s,a);else{if(l==="[object Undefined]")return!1;if(e.skipInvalid)return!1;throw new A("unacceptable kind of an object to dump "+l)}e.tag!==null&&e.tag!=="?"&&(u=encodeURI(e.tag[0]==="!"?e.tag.slice(1):e.tag).replace(/!/g,"%21"),e.tag[0]==="!"?u="!"+u:u.slice(0,18)==="tag:yaml.org,2002:"?u="!!"+u.slice(18):u="!<"+u+">",e.dump=u+" "+e.dump)}return!0}function _r(e,i){var n=[],r=[],t,s;for(Fe(e,n,r),t=0,s=r.length;t<s;t+=1)i.duplicates.push(n[r[t]]);i.usedDuplicates=new Array(s)}function Fe(e,i,n){var r,t,s;if(e!==null&&typeof e=="object")if(t=i.indexOf(e),t!==-1)n.indexOf(t)===-1&&n.push(t);else if(i.push(e),Array.isArray(e))for(t=0,s=e.length;t<s;t+=1)Fe(e[t],i,n);else for(r=Object.keys(e),t=0,s=r.length;t<s;t+=1)Fe(e[r[t]],i,n)}function kr(e,i){i=i||{};var n=new vr(i);n.noRefs||_r(e,n);var r=e;return n.replacer&&(r=n.replacer.call({"":r},"",r)),_(n,0,r,!0,!0)?n.dump+`
`:""}var Rr=kr,Or={dump:Rr};function Oe(e,i){return function(){throw new Error("Function yaml."+e+" is removed in js-yaml 4. Use yaml."+i+" instead, which is now safe by default.")}}var Br=w,Dr=xi,Pr=Ci,Lr=Ti,Mr=Fi,Ur=Ie,$r=qi.load,jr=qi.loadAll,Hr=Or.dump,Vr=A,Yr={binary:Ri,float:Si,map:yi,null:wi,pairs:Bi,set:Di,timestamp:_i,bool:Ei,int:Ai,merge:ki,omap:Oi,seq:vi,str:bi},qr=Oe("safeLoad","load"),Gr=Oe("safeLoadAll","loadAll"),Wr=Oe("safeDump","dump"),rn={Type:Br,Schema:Dr,FAILSAFE_SCHEMA:Pr,JSON_SCHEMA:Lr,CORE_SCHEMA:Mr,DEFAULT_SCHEMA:Ur,load:$r,loadAll:jr,dump:Hr,YAMLException:Vr,types:Yr,safeLoad:qr,safeLoadAll:Gr,safeDump:Wr};function ue(e){let i=e.trim();if(!i)return null;try{let n=rn.load(i);return!n||typeof n!="object"?null:n}catch{return null}}function on(e){let i=[],n=/```base\s*\n([\s\S]*?)```/g,r;for(;(r=n.exec(e))!==null;)i.push({fullMatch:r[0],yaml:r[1],start:r.index,end:r.index+r[0].length});return i}function sn(e){let i=[],n=/!\[\[([^\]#]+\.base)(?:#([^\]]+))?\]\]/g,r;for(;(r=n.exec(e))!==null;)i.push({fullMatch:r[0],filename:r[1],viewName:r[2]||void 0,start:r.index,end:r.index+r[0].length});return i}function Y(e){return/```base\s*\n|!\[\[[^\]]+\.base/.test(e)}function Be(e){let i=e.indexOf(".");if(i===-1)return{type:"note",name:e};let n=e.slice(0,i),r=e.slice(i+1);return{type:n,name:r}}function ln(e){return typeof e=="object"&&e!==null}function De(e,i,n={}){let r=e;return n.publishedOnly&&(r=r.filter(t=>t.isPublished)),i===void 0?r:r.filter(t=>Z(i,t))}function Z(e,i){if(typeof e=="string")return Kr(e,i);if(ln(e)){if("and"in e)return e.and.every(n=>Z(n,i));if("or"in e)return e.or.some(n=>Z(n,i));if("not"in e)return!e.not.some(n=>Z(n,i))}return!1}function Kr(e,i){let n=e.trim();if(!n)return!1;try{let r=n.match(/^file\.hasTag\(["']([^"']+)["']\)$/);if(r)return zr(r[1],i);let t=n.match(/^file\.inFolder\(["']([^"']+)["']\)$/);if(t)return Qr(t[1],i);let s=n.match(/^file\.hasLink\(["']([^"']+)["']\)$/);if(s)return Xr(s[1],i);let o=n.match(/^file\.hasProperty\(["']([^"']+)["']\)$/);if(o)return Zr(o[1],i);let l=n.match(/^(\w+)\s*(==|!=|>|<|>=|<=)\s*(.+)$/);if(l){let[,a,u,p]=l;return Jr(a,u,p,i)}return!1}catch{return!1}}function zr(e,i){let n=e.toLowerCase().replace(/^#/,"");return i.tags.some(r=>r.toLowerCase().replace(/^#/,"")===n)}function Qr(e,i){let n=i.folder.toLowerCase(),r=e.toLowerCase();return n===r||n.startsWith(`${r}/`)?!0:n.split("/").some(s=>s===r)}function Xr(e,i){let n=e.toLowerCase();return i.links.some(r=>r.toLowerCase()===n)}function Zr(e,i){return e in i.properties&&i.properties[e]!==void 0}function Jr(e,i,n,r){let t=r.properties[e],s=eo(n.trim());if(s===null){if(i==="==")return t==null;if(i==="!=")return t!=null}if(t==null)return i==="=="&&s===null;if(typeof s=="string"){let o=String(t);switch(i){case"==":return o===s;case"!=":return o!==s;case">":return o>s;case"<":return o<s;case">=":return o>=s;case"<=":return o<=s}}if(typeof s=="number"){let o=Number(t);if(Number.isNaN(o))return!1;switch(i){case"==":return o===s;case"!=":return o!==s;case">":return o>s;case"<":return o<s;case">=":return o>=s;case"<=":return o<=s}}return!1}function eo(e){if(e==="null")return null;if(e==="true")return!0;if(e==="false")return!1;let i=e.match(/^["'](.*)["']$/);if(i)return i[1];let n=Number(e);return Number.isNaN(n)?e:n}function Le(e,i,n={}){let r=io(e,n);if(!r){let s=n.viewName??n.viewIndex?.toString()??"default";return to(`View not found: ${s}`)}if(i.length===0)return ro();let t;switch(r.type){case"table":t=Pe(i,r,n,e);break;case"card":t=un(i,r,n);break;case"list":t=cn(i,r,n);break;default:t=Pe(i,r,n,e)}return`<div class="base-view">${t}</div>`}function io(e,i){if(!(!e.views||e.views.length===0))return i.viewName?e.views.find(n=>n.name===i.viewName):i.viewIndex!==void 0?e.views[i.viewIndex]:e.views[0]}function Pe(e,i,n={},r){let t=i.order??["file.name"],s=i.limit?e.slice(0,i.limit):e,o=t.map(a=>{let u=fn(a,r);return`<th>${F(u)}</th>`}),l=s.map(a=>`<tr>${t.map(p=>{let c=pn(p,a),f=Me(c);return p==="file.name"&&n.publishedSlugs?.has(a.slug)?`<td><a href="/${a.slug}">${F(f)}</a></td>`:`<td>${F(f)}</td>`}).join("")}</tr>`);return`<table class="base-table">
<thead><tr>${o.join("")}</tr></thead>
<tbody>${l.join(`
`)}</tbody>
</table>`}function un(e,i,n={}){let r=i.order??["file.name"];return`<div class="base-cards">${(i.limit?e.slice(0,i.limit):e).map(o=>{let l=o.title,a=n.publishedSlugs?.has(o.slug)?`<a href="/${o.slug}">${F(l)}</a>`:F(l),p=r.filter(c=>c!=="file.name").map(c=>{let f=pn(c,o),h=Me(f),m=fn(c);return`<div class="base-card-prop"><span class="base-card-label">${F(m)}:</span> ${F(h)}</div>`}).join(`
`);return`<div class="base-card">
<div class="base-card-title">${a}</div>
${p}
</div>`}).join(`
`)}</div>`}function cn(e,i,n={}){return`<ul class="base-list">${(i.limit?e.slice(0,i.limit):e).map(s=>{let o=s.title;return`<li>${n.publishedSlugs?.has(s.slug)?`<a href="/${s.slug}">${F(o)}</a>`:F(o)}</li>`}).join(`
`)}</ul>`}function pn(e,i){let{type:n,name:r}=Be(e);switch(n){case"file":return no(r,i);case"note":return i.properties[r];case"formula":return;default:return i.properties[e]}}function no(e,i){switch(e){case"name":return i.title;case"folder":return i.folder;case"ext":return i.ext;case"ctime":return i.ctime;case"mtime":return i.mtime;case"size":return i.size;case"path":return`${i.folder}/${i.title}`;default:return}}function Me(e){return e==null?"":typeof e=="boolean"?e?"Yes":"No":typeof e=="number"?e>9466848e5?new Date(e).toLocaleDateString():e.toString():Array.isArray(e)?e.map(i=>Me(i)).join(", "):String(e)}function fn(e,i){if(i?.properties?.[e]?.displayName)return i.properties[e].displayName;let{type:n,name:r}=Be(e);if(n==="file")switch(r){case"name":return"Name";case"folder":return"Folder";case"ext":return"Extension";case"ctime":return"Created";case"mtime":return"Modified";case"size":return"Size";case"path":return"Path";default:return an(r)}return an(r)}function to(e){return`<div class="base-error">${F(e)}</div>`}function ro(){return'<div class="base-empty">No results</div>'}function an(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)}function dn(e,i,n,r){let t=[];if(i?.frontmatter?.tags){let a=i.frontmatter.tags;Array.isArray(a)?t.push(...a.map(u=>u.startsWith("#")?u:`#${u}`)):typeof a=="string"&&t.push(a.startsWith("#")?a:`#${a}`)}if(i?.tags)for(let a of i.tags)t.includes(a.tag)||t.push(a.tag);let s=[];if(i?.links)for(let a of i.links)s.includes(a.link)||s.push(a.link);let o=e.parent?.path??"",l={};if(i?.frontmatter)for(let[a,u]of Object.entries(i.frontmatter))a==="position"||a==="tags"||(l[a]=u);return{file:e,slug:U(e),title:e.basename,tags:t,folder:o,properties:l,links:s,ctime:e.stat.ctime,mtime:e.stat.mtime,ext:e.extension,size:e.stat.size,isPublished:r}}async function Ue(e,i){let n=e.vault.getMarkdownFiles(),r=[];for(let t of n){if(t.path.startsWith(".trash/")||t.path.startsWith(".obsidian/"))continue;let s=await e.vault.cachedRead(t),o=e.metadataCache.getFileCache(t),l=U(t),a=i.has(l);r.push(dn(t,o,s,a))}return r}function $e(e){return new Set(e.map(i=>U(i)))}async function He(e,i,n,r){if(!Y(e))return e;let t=e,s=sn(e);for(let l of s.reverse()){let a=await oo(l.filename,l.viewName,i,n,r);t=t.slice(0,l.start)+a+t.slice(l.end)}let o=on(t);for(let l of o.reverse()){let a=lo(l.yaml,n,r);t=t.slice(0,l.start)+a+t.slice(l.end)}return t}async function oo(e,i,n,r,t){let s=so(n,e);if(!s)return je(`Base file not found: ${e}`);let o=await n.vault.cachedRead(s),l=ue(o);return l?hn(l,r,t,{viewName:i}):je(`Failed to parse base file: ${e}`)}function so(e,i){let n=e.vault.getFiles();for(let t of n)if(t.path===i||t.path===`${i}`)return t;let r=i.split("/").pop()||i;for(let t of n)if(t.name===r&&t.extension==="base")return t;return null}function lo(e,i,n){let r=ue(e);return r?hn(r,i,n,{}):je("Failed to parse inline base")}function hn(e,i,n,r){let t=ao(e,r),s=e.filters;t?.filters&&(s?s={and:[s,t.filters]}:s=t.filters);let o=De(i,s,{publishedOnly:n.hideUnpublished});return Le(e,o,{publishedSlugs:n.publishedSlugs,viewName:r.viewName,viewIndex:r.viewIndex})}function ao(e,i){if(!(!e.views||e.views.length===0))return i.viewName?e.views.find(n=>n.name===i.viewName):i.viewIndex!==void 0?e.views[i.viewIndex]:e.views[0]}function je(e){return`<div class="base-error">${F(e)}</div>`}async function uo(e,i,n,r,t){t?.("Checking existing images on server...");let s={};try{s=(await i.getImages(n)).images}catch(u){console.error("Failed to fetch server images:",u)}let o=new Set(Object.keys(s)),l=[],a=new Set;for(let u of r){let p=await e.vault.cachedRead(u),c=Ze(p);for(let f of c)a.add(f)}for(let u of a){if(o.has(u))continue;let p=Je(e,u);p&&l.push({filename:u,file:p})}for(let u=0;u<l.length;u++){let{filename:p,file:c}=l[u];t?.(`Uploading image ${u+1}/${l.length}: ${p}`);try{let f=await e.vault.readBinary(c);await i.uploadImage(n,f,p)}catch(f){console.error(`[Pubit] Failed to upload image ${p}:`,f)}}}async function mn(e,i,n,r,t="publish",s={}){let o=[],l=s.hideUnpublishedInBases??!0;try{r?.("Collecting local notes...",5);let a=await Qe(e,t),u=$e(a);r?.("Fetching remote state...",10);let p=await i.getNotes(n),c=new Map(p.map(v=>[v.slug,v.contentHash]));r?.("Syncing images...",15),await uo(e,i,n,a,v=>r?.(v,20)),r?.("Checking for bases...",22);let f=null,h=!1;for(let v of a){let T=await e.vault.cachedRead(v);if(Y(T)){h=!0;break}}h&&(r?.("Building vault context for bases...",24),f=await Ue(e,u)),r?.("Computing changes...",25);let m=[],x=[],b=new Set,S=0;for(let v of a){let T=U(v),k=Xe(v),de=v.path.replace(/\.md$/,""),R=await e.vault.cachedRead(v);f&&Y(R)&&(R=await He(R,e,f,{publishedSlugs:u,hideUnpublished:l}));let xn=await ge(R);b.add(T);let Ve=c.get(T);!Ve||Ve!==xn?m.push({slug:T,title:k,content:R,originalPath:de}):S++}for(let[v]of c)b.has(v)||x.push(v);let g=0;if(m.length>0){let v=m.length;for(let T=0;T<m.length;T++){let k=m[T],de=30+T/v*40;r?.(`Uploading ${T+1}/${v}: ${k.slug.split("/").pop()}...`,de);try{await i.uploadNote(n,k.slug,k.title,k.content,k.originalPath),g++}catch(R){o.push(`Upload failed: ${k.slug} - ${R instanceof Error?R.message:"Unknown"}`)}}}let fe=0;if(x.length>0){r?.(`Deleting ${x.length} orphaned notes...`,75);for(let v of x)try{await i.deleteNote(n,v),fe++}catch(T){o.push(`Delete failed: ${v} - ${T instanceof Error?T.message:"Unknown"}`)}}if(g>0||fe>0){r?.("Publishing...",85);let v=await i.publish(n);return{success:o.length===0,uploaded:g,deleted:fe,unchanged:S,errors:o,siteUrl:v.url}}r?.("Publishing...",90);let gn=await i.publish(n);return{success:!0,uploaded:0,deleted:0,unchanged:a.length,errors:[],siteUrl:gn.url}}catch(a){return{success:!1,uploaded:0,deleted:0,unchanged:0,errors:[a instanceof Error?a.message:"Unknown error"]}}}var ce=class extends pe.Plugin{settings=G;api=null;statusBarItem=null;settingsTab=null;ribbonIcon=null;hasPendingChanges=!1;styleEl=null;async onload(){await this.loadSettings(),this.api=new q(ve,this.settings.apiToken),this.registerStyles(),this.ribbonIcon=this.addRibbonIcon("upload-cloud","Publish notes",async()=>{await this.publish()}),this.registerEvent(this.app.vault.on("modify",()=>this.markPendingChanges())),this.registerEvent(this.app.vault.on("create",()=>this.markPendingChanges())),this.registerEvent(this.app.vault.on("delete",()=>this.markPendingChanges())),this.registerEvent(this.app.vault.on("rename",()=>this.markPendingChanges())),this.addCommand({id:"publish-sync",name:"Sync and publish",callback:async()=>{await this.publish()}}),this.addCommand({id:"publish-connect",name:"Connect vault",callback:async()=>{await this.startDeviceCodeFlow()}}),this.addCommand({id:"publish-disconnect",name:"Disconnect vault",callback:async()=>{await this.disconnect()}}),this.settingsTab=new ne(this.app,this),this.addSettingTab(this.settingsTab),this.statusBarItem=this.addStatusBarItem(),this.updateStatusBar()}async loadSettings(){this.settings=Object.assign({},G,await this.loadData())}async saveSettings(){await this.saveData(this.settings),this.api&&(this.api=new q(ve,this.settings.apiToken)),this.updateStatusBar()}showNotice(i){new pe.Notice(i)}updateStatusBar(){this.statusBarItem&&(this.settings.apiToken?this.hasPendingChanges?(this.statusBarItem.setText("Publish: Changes pending"),this.statusBarItem.setAttribute("aria-label","Click ribbon icon to sync")):(this.statusBarItem.setText("Publish: Up to date"),this.statusBarItem.setAttribute("aria-label","All synced")):(this.statusBarItem.setText("Publish: Not connected"),this.statusBarItem.setAttribute("aria-label","Click to connect")))}markPendingChanges(){this.settings.apiToken&&(this.hasPendingChanges||(this.hasPendingChanges=!0,this.updatePendingIndicator(),this.updateStatusBar()))}clearPendingChanges(){this.hasPendingChanges=!1,this.updatePendingIndicator(),this.updateStatusBar()}updatePendingIndicator(){this.ribbonIcon&&(this.hasPendingChanges?(this.ribbonIcon.addClass("has-pending-changes"),this.ribbonIcon.setAttribute("aria-label","Publish notes (changes pending)")):(this.ribbonIcon.removeClass("has-pending-changes"),this.ribbonIcon.setAttribute("aria-label","Publish notes")))}registerStyles(){this.styleEl=document.createElement("style"),this.styleEl.id="publish-plugin-styles",this.styleEl.textContent=`
			.side-dock-ribbon-action.has-pending-changes::after {
				content: '';
				position: absolute;
				top: 6px;
				right: 6px;
				width: 8px;
				height: 8px;
				background: var(--color-accent);
				border-radius: 50%;
				border: 2px solid var(--background-primary);
			}
			
			.side-dock-ribbon-action.has-pending-changes {
				position: relative;
			}
		`,document.head.appendChild(this.styleEl)}onunload(){this.styleEl&&this.styleEl.remove()}async startDeviceCodeFlow(){if(!this.api){this.showNotice("Plugin not initialized");return}try{let i=await this.api.getDeviceCode();new J(this.app,i.code,i.verificationUrl,this.api,async r=>{this.settings.apiToken=r.token,this.settings.userEmail=r.email,this.settings.siteId=r.siteId,this.settings.subdomain=r.subdomain,await this.saveSettings(),this.api?.setToken(r.token),this.settingsTab?.display();let t=r.subdomain?` Your site: ${r.subdomain}.pubit.site`:"";this.showNotice(`Successfully connected!${t}`)},()=>{}).open()}catch(i){this.showNotice(`Failed to start connection: ${i instanceof Error?i.message:"Unknown error"}`)}}async disconnect(){if(!this.api||!this.settings.apiToken){this.showNotice("Not connected");return}let i=this.settings.subdomain;try{await this.api.revokeToken()}catch{}this.settings.apiToken=void 0,this.settings.siteId=void 0,this.settings.userEmail=void 0,this.settings.subdomain=void 0,await this.saveSettings(),i?this.showNotice(`Disconnected. Your site remains online at ${i}.pubit.site. To delete it, visit the dashboard.`):this.showNotice("Disconnected")}async publish(){if(!this.api){this.showNotice("Plugin not initialized");return}if(!this.settings.apiToken){this.showNotice("Please connect your vault first"),await this.startDeviceCodeFlow();return}if(!this.settings.siteId){this.showNotice("No site configured. Please disconnect and reconnect.");return}let i=new ie(this.app);i.open();try{let n=await mn(this.app,this.api,this.settings.siteId,(r,t)=>{i.setStatus(r),t!==void 0&&i.setProgress(t)},this.settings.publishTag||"publish");n.success?(i.showSuccess(n.siteUrl||"",{uploaded:n.uploaded,deleted:n.deleted,unchanged:n.unchanged}),this.clearPendingChanges()):i.showError(n.errors.join(`
`))}catch(n){i.showError(n instanceof Error?n.message:"Unknown error")}}async createSite(){if(this.api)return new Promise(i=>{new ee(this.app,this.api,"pubit.site",async(r,t)=>{this.settings.siteId=r,this.settings.subdomain=t,await this.saveSettings(),this.showNotice(`Site created: ${t}.pubit.site`),i()},()=>{i()}).open()})}async changeSubdomain(){if(!this.api){this.showNotice("Plugin not initialized");return}if(!this.settings.apiToken){this.showNotice("Please connect your vault first");return}this.showNotice("Subdomain change coming soon! For now, disconnect and reconnect to get a new subdomain.")}};
/*! Bundled license information:

js-yaml/dist/js-yaml.mjs:
  (*! js-yaml 4.1.1 https://github.com/nodeca/js-yaml @license MIT *)
*/
